{"version":3,"sources":["Navbar.js","Player.js","DFT.js","colorMapping.js","getDftMatrices.js","roses.js","svgNotation/whole.svg","svgNotation/half.svg","svgNotation/quarter.svg","svgNotation/eighth.svg","svgNotation/sixteenth.svg","ResolutionSelector.js","PcvChipsBox.js","Markdown.js","logos/placeholder.png","Footer.js","HomeMarkdown.md","pages/Home.js","TheoryMarkdown.md","pages/Theory.js","Wavescape.js","WavescapeModule.js","Circle.js","prototypesData.js","CoefficientsModule.js","pages/Analysis.js","CircleSVG.js","WavescapeSVG.js","SaveDialog.js","App.js","parser.js","index.js"],"names":["AppBar","styled","MuiAppBar","shouldForwardProp","prop","theme","open","transition","transitions","create","easing","sharp","duration","leavingScreen","width","marginLeft","easeOut","enteringScreen","Navbar","setOpen","inAnalysisPage","Box","sx","flexGrow","position","Toolbar","IconButton","disabled","color","onClick","edge","mr","display","Typography","variant","component","ButtonGroup","Button","Link","to","disableElevation","part","intervalID","currentSongDuration","TinyText","fontSize","opacity","fontWeight","letterSpacing","formatDuration","value","minute","Math","floor","secondLeft","setPlayerMidiData","midiData","resolution","setCurrentSubdiv","Tone","cancel","stop","partNotes","tracks","forEach","track","notes","note","push","subdiv","time","sampler","triggerAttackRelease","name","velocity","start","loop","loopEnd","urls","A0","C1","A1","C2","A2","C3","A3","C4","A4","C5","A5","C6","A6","C7","A7","C8","release","baseUrl","toDestination","Player","fileName","currentWavescapeSubdiv","useState","playbackSliderProgress","setPlaybackSliderProgress","play","console","log","state","resume","setInterval","progress","useEffect","document","addEventListener","e","which","preventDefault","pause","stopInterval","bind","flexDirection","alignItems","justifyContent","Stack","direction","paddingLeft","disableFocusRipple","padding","size","children","noWrap","paddingRight","Slider","onChange","event","newValue","seconds","mt","clearInterval","volume","dft","pcv","normalize","round","polar","N","length","coeffs","k","temp","n","math","slice","norm","map","coeff","re","im","toPolar","sumAndNormalize","sum","i","j","contToDiscRGB","d3","domain","range","gradient","angle","r","g","b","pixelColor","x","y","distance","atan2","PI","a","getRgbaFromComplex","complex","polarComplex","phi","mod","ris","Pcv","this","C","Cs","D","Ds","E","F","Fs","G","Gs","A","As","B","targetPitch","getDftCoeffDynamic","resolutionMode","currentSongBPM","noteResolutionValue","useSeconds","isNaN","tracksSubdivision","filter","instrument","percussion","getSubdivision","pcvSubdivision","pitch","addNoteDuration","dftCoeffsSubdivision","getPcvAsArray","dftCoeffsMatrix","traces","firstRow","tracesData","subdivision","wndLen","cursor","isValidNote","noteAndDuration","getRosePoints","d","dataPoints","delta","cos","sin","ResolutionSelector","setResolutionMode","retriggerAnalysis","isInputSecondsInvalid","setIsInputSecondsInvalid","resolutionTextRef","useRef","FormControl","RadioGroup","row","defaultValue","newResolutionMode","parseFloat","current","target","FormControlLabel","control","Radio","label","style","height","transform","src","sixteenthSvg","eighthSvg","marginTop","quarterSvg","halfSvg","wholeSvg","TextField","minHeight","maxWidth","error","helperText","id","inputRef","ListItem","margin","spacing","PcvChipsBox","userPcvs","setUserPcvs","rosesMat","Paper","flexWrap","listStyle","p","overflow","data","Chip","isDisabled","icon","xmlns","viewBox","fill","stroke","strokeWidth","points","rosePoints","onDelete","chipToDelete","used","chips","chip","options","overrides","h1","props","gutterBottom","h2","h3","h4","paragraph","myRef","React","parseInt","href","ref","scrollIntoView","behavior","li","typography","Markdown","Footer","logoSize","textAlign","logo","marginRight","Home","setInAnalysisPage","content","setContent","fetch","HomeMarkdown","then","response","text","Theory","TheoryMarkdown","block","verticalScale","Wavescape","ticks","wsNumber","wavescapeMatrix","wavescapeWidth","canvasRef","wsCoordinates","setWsCoordinates","ticksHeight","setTicksHeight","baseSubdivision","canvas","ctx","getContext","margins","innerSize","clearRect","innerWidth","innerHeight","unit","mat","computeTicks","beginPath","moveTo","lineTo","fillStyle","drawWavescape","cx","cy","textAnchor","coord","x1","x2","y1","y2","WavescapeModule","wavescapesData","elemsWidth","savedImage","Circle","pcvData","coeffNumber","protoDataCoeff","fullTrace","traceDataCoeff","userPcvsCoeff","currentSubdiv","performanceCoeff","targetCircleWidth","showMagAndPhase","showFullTrace","mu","currentSubdivCoeff","setCurrentSubdivCoeff","circleRadius","marksRadiusRatio","cartesianToPolar","sqrt","Number","EPSILON","drawTrace","element","arc","radius","devicePixelRatio","image","createImageData","scale","index","rgba","putImageData","save","translate","restore","getImageData","marginBottom","zIndex","innerRadius","outerRadius","startAngle","endAngle","mark","scaleRatio","labelName","subSup","isSub","includes","dxOffset","sign","dyOffset","dx","dy","baselineShift","protoCircleMark","translateX","translateY","polarCoord","widthSvg","Tooltip","placement","arrow","title","fillOpacity","svgRoseIcon","radiusScaleWidth","highlight","opacityArray","reverse","highlightSubdiv","prototypesData","CoefficientsModule","fullTraces","coeffTracesData","showPrototypes","midiDevNotesDftCoeffs","selectedProtoPitchClasses","setSelectedProtoPitchClasses","subdivUserPcvs","setSubdivUserPcvs","tempSubdivUserPcvs","coeffNum","Application","setShowPrototypes","setShowMagAndPhase","setShowFullTrace","setMidiDevNotesDftCoeffs","accordionRef","accordionWidth","setAccordionWidth","elemsForEachRow","setElemsForEachRow","setElemsWidth","changeElementsSize","drawerOffset","adjustmentFractSizes","clientWidth","handleResize","window","currentNotes","handleInput","input","command","toNote","triggerAttack","triggerRelease","currentNote","playedNotes","dftCoeffs","computeDftCoeffs","updateDevices","port","manufacturer","type","navigator","requestMIDIAccess","midiAccess","onstatechange","inputs","onmidimessage","Accordion","defaultExpanded","AccordionSummary","expandIcon","AccordionDetails","top","bottom","maxHeight","FormGroup","Switch","checked","minWidth","min","max","valueLabelDisplay","marks","fullWidth","InputLabel","Select","MenuItem","traceData","userPcv","showNumber","theta","angles","circularSectors","inner","offset","strokeOpacity","circleMark","WavescapeSVG","elem","SaveDialog","currentSongMidiData","canSave","setCanSave","checkNumb","setCheckNumb","checkTrace","setCheckTrace","checkProto","setCheckProto","checkPcvs","setCheckPcvs","anchorEl","setAnchorEl","openPopover","Boolean","undefined","handleClose","saveImages","zip","JSZip","circleSVG","CircleSVG","ReactDOMServer","renderToStaticMarkup","generateCircleSVG","wavescapeSVG","generateWavescapeSVG","file","generateAsync","saveAs","Dialog","onClose","DialogTitle","DialogContent","DialogContentText","Checkbox","DialogActions","currentTarget","autoFocus","Popover","anchorOrigin","vertical","horizontal","Main","backgroundColor","DrawerHeader","mixins","toolbar","App","useTheme","setFile","setWavescapesData","setCoeffTracesData","windowedCoeffTraces","setWindowedCoeffTraces","windowLen","setWindowLen","invalidWndLen","setInvalidWndLen","textfieldWndLen","setTextfieldWndLen","wavescapeResolution","setWavescapeResolution","circleResolution","setCircleResolution","pcvTextRef","isInputPcvInvalid","setIsInputPcvInvalid","setRosesMat","handleSubmitPitchClass","parsedInput","userPcvObjects","pcvs","isGroup","isSet","stringGroup","Error","join","numeralInput","count","num","lastNum","bin","parse","message","pcvObj","found","usable","trace","windowedTrace","smoothedPoint","getElementById","files","fileReader","FileReader","readAsArrayBuffer","onload","loadedFile","binMidiFile","Midi","tempos","header","tempo","bpm","midiBpm","nonPercussiveTracks","getMidiFileDataObject","result","staticResolution","matrixHeight","rowsWidth","wndLenUnits","windowed","rgbaMatrices","matrix","getRgbaMatrix","midiFile","getDftCoeffStatic","initMatrix","rose","exPcvObjects","toString","CssBaseline","Drawer","flexShrink","boxSizing","anchor","htmlFor","Divider","paddingTop","inputProps","heigth","noValidate","autoComplete","key","exact","path","render","Analysis","customTheme","createTheme","palette","primary","main","secondary","background","default","ReactDOM","StrictMode","ThemeProvider"],"mappings":"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","file":"static/js/main.25088f1f.chunk.js","sourcesContent":["import React from 'react';\r\nimport MuiAppBar from '@mui/material/AppBar';\r\nimport Box from '@mui/material/Box';\r\nimport Toolbar from '@mui/material/Toolbar';\r\nimport Typography from '@mui/material/Typography';\r\nimport Button from '@mui/material/Button';\r\nimport ButtonGroup from '@mui/material/ButtonGroup';\r\nimport { Link } from 'react-router-dom';\r\nimport { styled, useTheme } from '@mui/material/styles';\r\n\r\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\r\nimport IconButton from '@mui/material/IconButton';\r\n\r\nconst drawerWidth = 400;\r\n\r\nconst AppBar = styled(MuiAppBar, {\r\n  shouldForwardProp: (prop) => prop !== 'open',\r\n})(({ theme, open }) => ({\r\n  transition: theme.transitions.create(['margin', 'width'], {\r\n    easing: theme.transitions.easing.sharp,\r\n    duration: theme.transitions.duration.leavingScreen,\r\n  }),\r\n  ...(open && {\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    marginLeft: `${drawerWidth}px`,\r\n    transition: theme.transitions.create(['margin', 'width'], {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  }),\r\n}));\r\n\r\nexport default function Navbar({ open, setOpen, inAnalysisPage }) {\r\n  const handleDrawerOpen = () => {\r\n    setOpen(true);\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ flexGrow: 1 }}>\r\n      <AppBar position='static' open={open}>\r\n        <Toolbar>\r\n          <IconButton\r\n            disabled={!inAnalysisPage}\r\n            color='inherit'\r\n            aria-label='open drawer'\r\n            onClick={handleDrawerOpen}\r\n            edge='start'\r\n            sx={{ mr: 2, ...(open && { display: 'none' }) }}\r\n          >\r\n            <ChevronRightIcon />\r\n          </IconButton>\r\n          <Typography variant='h3' component='div' sx={{ flexGrow: 1 }}>\r\n            Mi_DFT\r\n          </Typography>\r\n          <ButtonGroup aria-label='outlined button group'>\r\n            <Button\r\n              component={Link}\r\n              to='/'\r\n              variant='contained'\r\n              disableElevation={true}\r\n            >\r\n              Home\r\n            </Button>\r\n            <Button\r\n              component={Link}\r\n              to='/theory'\r\n              variant='contained'\r\n              disableElevation={true}\r\n            >\r\n              Theory\r\n            </Button>\r\n            <Button\r\n              component={Link}\r\n              to='/analysis'\r\n              variant='contained'\r\n              disableElevation={true}\r\n            >\r\n              Analysis\r\n            </Button>\r\n          </ButtonGroup>\r\n        </Toolbar>\r\n      </AppBar>\r\n    </Box>\r\n  );\r\n}\r\n","import * as Tone from 'tone';\r\nimport { useEffect, useState } from 'react';\r\n\r\nimport Box from '@mui/material/Box';\r\nimport Stack from '@mui/material/Stack';\r\nimport PlayArrowRoundedIcon from '@mui/icons-material/PlayArrowRounded';\r\nimport PauseRoundedIcon from '@mui/icons-material/PauseRounded';\r\nimport StopRoundedIcon from '@mui/icons-material/StopRounded';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport Slider from '@mui/material/Slider';\r\nimport { styled } from '@mui/material/styles';\r\nimport Typography from '@mui/material/Typography';\r\n\r\nlet part;\r\nlet currentSongDuration = 0; // seconds\r\nlet intervalID;\r\n\r\nconst TinyText = styled(Typography)({\r\n  fontSize: '0.75rem',\r\n  opacity: 0.38,\r\n  fontWeight: 500,\r\n  letterSpacing: 0.2,\r\n});\r\n\r\nfunction formatDuration(value) {\r\n  const minute = Math.floor(value / 60);\r\n  const secondLeft = Math.floor(value - minute * 60);\r\n  return `${minute}:${secondLeft < 9 ? `0${secondLeft}` : secondLeft}`;\r\n}\r\n\r\nexport function setPlayerMidiData(midiData, resolution, setCurrentSubdiv) {\r\n  //Remove the scheduled previous song\r\n  Tone.Transport.cancel(0);\r\n  setCurrentSubdiv(0);\r\n  Tone.Transport.stop();\r\n\r\n  currentSongDuration = midiData.duration;\r\n\r\n  let partNotes = [];\r\n  midiData.tracks.forEach((track) =>\r\n    track.notes.forEach((note) => {\r\n      partNotes.push(note);\r\n    })\r\n  );\r\n\r\n  partNotes.forEach((note) => {\r\n    note.subdiv = Math.floor(note.time / resolution);\r\n  });\r\n\r\n  part = new Tone.Part(\r\n    (time, note) => {\r\n      sampler.triggerAttackRelease(\r\n        note.name,\r\n        note.duration,\r\n        time,\r\n        note.velocity\r\n      );\r\n      setCurrentSubdiv(note.subdiv);\r\n    },\r\n    [...partNotes]\r\n  ).start(0);\r\n\r\n  part.loop = true;\r\n  part.loopEnd = currentSongDuration;\r\n}\r\n\r\nconst sampler = new Tone.Sampler({\r\n  urls: {\r\n    A0: 'A0.mp3',\r\n    C1: 'C1.mp3',\r\n    'D#1': 'Ds1.mp3',\r\n    'F#1': 'Fs1.mp3',\r\n    A1: 'A1.mp3',\r\n    C2: 'C2.mp3',\r\n    'D#2': 'Ds2.mp3',\r\n    'F#2': 'Fs2.mp3',\r\n    A2: 'A2.mp3',\r\n    C3: 'C3.mp3',\r\n    'D#3': 'Ds3.mp3',\r\n    'F#3': 'Fs3.mp3',\r\n    A3: 'A3.mp3',\r\n    C4: 'C4.mp3',\r\n    'D#4': 'Ds4.mp3',\r\n    'F#4': 'Fs4.mp3',\r\n    A4: 'A4.mp3',\r\n    C5: 'C5.mp3',\r\n    'D#5': 'Ds5.mp3',\r\n    'F#5': 'Fs5.mp3',\r\n    A5: 'A5.mp3',\r\n    C6: 'C6.mp3',\r\n    'D#6': 'Ds6.mp3',\r\n    'F#6': 'Fs6.mp3',\r\n    A6: 'A6.mp3',\r\n    C7: 'C7.mp3',\r\n    'D#7': 'Ds7.mp3',\r\n    'F#7': 'Fs7.mp3',\r\n    A7: 'A7.mp3',\r\n    C8: 'C8.mp3',\r\n  },\r\n  release: 1,\r\n  baseUrl: 'https://tonejs.github.io/audio/salamander/',\r\n}).toDestination();\r\nsampler.volume.value = -20;\r\n\r\nexport default function Player({ fileName, currentWavescapeSubdiv }) {\r\n  const [playbackSliderProgress, setPlaybackSliderProgress] = useState(0);\r\n\r\n  function play() {\r\n    console.log('play');\r\n    if (Tone.context.state !== 'running') {\r\n      console.log('state running');\r\n      Tone.context.resume();\r\n    }\r\n    Tone.Transport.start();\r\n    if (!intervalID && part)\r\n      intervalID = setInterval(\r\n        () => setPlaybackSliderProgress(part.progress),\r\n        1000\r\n      );\r\n  }\r\n\r\n  useEffect(() => {\r\n    function handleKeyDown(e) {\r\n      if (e.which === 32) {\r\n        e.preventDefault();\r\n        if (\r\n          Tone.Transport.state === 'paused' ||\r\n          Tone.Transport.state === 'stopped'\r\n        )\r\n          play();\r\n        else if (Tone.Transport.state === 'started') {\r\n          Tone.Transport.pause();\r\n          stopInterval();\r\n        }\r\n      }\r\n    }\r\n\r\n    document.addEventListener('keydown', handleKeyDown.bind(this));\r\n  }, []);\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'center',\r\n        width: '60%',\r\n      }}\r\n    >\r\n      <Box\r\n        sx={{\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: 'space-between',\r\n          width: '100%',\r\n        }}\r\n      >\r\n        <Stack direction='row' sx={{ flexGrow: 1, paddingLeft: '10%' }}>\r\n          <IconButton\r\n            disableFocusRipple\r\n            sx={{ padding: '0' }}\r\n            onClick={() => {\r\n              console.log('stop');\r\n              Tone.Transport.stop();\r\n              stopInterval();\r\n            }}\r\n            size='large'\r\n            children={<StopRoundedIcon fontSize='large' />}\r\n          />\r\n          <IconButton\r\n            disableFocusRipple\r\n            sx={{ padding: '0' }}\r\n            onClick={() => {\r\n              console.log('pause');\r\n              Tone.Transport.pause();\r\n              stopInterval();\r\n            }}\r\n            size='large'\r\n            children={<PauseRoundedIcon fontSize='large' />}\r\n          />\r\n          <IconButton\r\n            disableFocusRipple\r\n            sx={{ padding: '0' }}\r\n            onClick={() => play()}\r\n            size='large'\r\n            children={<PlayArrowRoundedIcon fontSize='large' />}\r\n          />\r\n        </Stack>\r\n        <Typography\r\n          color={fileName ? 'primary' : 'error'}\r\n          noWrap={true}\r\n          sx={{ flexGrow: '2', paddingRight: '10%' }}\r\n        >\r\n          {fileName ? fileName : 'No midi file uploaded'}\r\n        </Typography>\r\n      </Box>\r\n      <Slider\r\n        aria-label='Playback'\r\n        size='small'\r\n        value={playbackSliderProgress ? playbackSliderProgress * 100 : 0}\r\n        onChange={(event, newValue) => {\r\n          setPlaybackSliderProgress(newValue / 100);\r\n          Tone.Transport.seconds = (newValue / 100) * currentSongDuration;\r\n        }}\r\n        sx={{ width: '90%' }}\r\n      />\r\n      <Box\r\n        sx={{\r\n          display: 'flex',\r\n          width: '90%',\r\n          alignItems: 'center',\r\n          justifyContent: 'space-between',\r\n          mt: -1,\r\n        }}\r\n      >\r\n        <TinyText>\r\n          -\r\n          {formatDuration(\r\n            currentSongDuration - playbackSliderProgress * currentSongDuration\r\n          )}\r\n        </TinyText>\r\n        <TinyText>{formatDuration(currentSongDuration)}</TinyText>\r\n      </Box>\r\n    </Box>\r\n  );\r\n}\r\n\r\nfunction stopInterval() {\r\n  clearInterval(intervalID);\r\n  // release our intervalID from the variable\r\n  intervalID = null;\r\n}\r\n","import * as math from 'mathjs';\r\n\r\n// Compute the DFT on the input pcv\r\nexport default function dft(\r\n  pcv,\r\n  normalize = true,\r\n  round = false,\r\n  polar = false\r\n) {\r\n  let N = pcv.length;\r\n\r\n  let coeffs = [];\r\n\r\n  for (let k = 0; k < N / 2 + 1; k++) {\r\n    let temp = 0;\r\n    for (let n = 0; n < N; n++) {\r\n      temp = math.add(\r\n        math.multiply(\r\n          pcv[n],\r\n          math.exp(math.multiply(math.i, (-2 * math.pi * k * n) / N))\r\n        ),\r\n        temp\r\n      );\r\n    }\r\n    coeffs.push(temp);\r\n  }\r\n\r\n  coeffs = coeffs.slice();\r\n\r\n  if (normalize) {\r\n    const norm = coeffs[0];\r\n    //'!=' gives a warning but '!==' doesn't compute correctly the if statement\r\n    if (norm != 0) coeffs = coeffs.map((coeff) => math.divide(coeff, norm));\r\n  }\r\n\r\n  if (round) {\r\n    coeffs.forEach((coeff) => {\r\n      coeff.re = Math.round(coeff.re * 10000) / 10000;\r\n      coeff.im = Math.round(coeff.im * 10000) / 10000;\r\n    });\r\n  }\r\n\r\n  if (polar) {\r\n    coeffs = coeffs.map((coeff) => coeff.toPolar());\r\n  }\r\n\r\n  return coeffs;\r\n}\r\n\r\nexport function sumAndNormalize(coeffs) {\r\n  let sum = coeffs[0];\r\n  for (let i = 1; i < coeffs.length; i++) {\r\n    //incremental sum for each coeff\r\n    let temp = [];\r\n    //coeff per coeff sum\r\n    for (let j = 0; j < coeffs[i].length; j++) {\r\n      temp.push(math.add(sum[j], coeffs[i][j]));\r\n    }\r\n    sum = temp.slice();\r\n  }\r\n\r\n  const norm = sum[0];\r\n  sum = sum.map((coeff) => math.divide(coeff, norm));\r\n\r\n  return sum;\r\n}\r\n","import * as d3 from 'd3';\r\nimport * as math from 'mathjs';\r\n\r\n//Convert rgb values from [0,1] to [0,255]\r\nconst contToDiscRGB = d3\r\n  .scaleQuantize()\r\n  .domain([0, 1])\r\n  .range(d3.range(0, 255, 1));\r\n\r\n//Generate the color space using the color mapping suggested in the paper\r\nexport const gradient = (angle) => {\r\n  let r, g, b;\r\n\r\n  if (angle >= 0 && angle < math.pi / 3) {\r\n    r = 1;\r\n    g = (3 * angle) / math.pi;\r\n    b = 0;\r\n  } else if (angle >= math.pi / 3 && angle < (math.pi * 2) / 3) {\r\n    r = 2 - (3 * angle) / math.pi;\r\n    g = 1;\r\n    b = 0;\r\n  } else if (angle >= (math.pi * 2) / 3 && angle < math.pi) {\r\n    r = 0;\r\n    g = 1;\r\n    b = (3 * angle) / math.pi - 2;\r\n  } else if (angle >= math.pi && angle < (math.pi * 4) / 3) {\r\n    r = 0;\r\n    g = 4 - (3 * angle) / math.pi;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 4) / 3 && angle < (math.pi * 5) / 3) {\r\n    r = (3 * angle) / math.pi - 4;\r\n    g = 0;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 5) / 3 && angle < 2 * math.pi) {\r\n    r = 1;\r\n    g = 0;\r\n    b = 6 - (3 * angle) / math.pi;\r\n  }\r\n\r\n  r = contToDiscRGB(r);\r\n  g = contToDiscRGB(g);\r\n  b = contToDiscRGB(b);\r\n\r\n  return `rgb(${r}, ${g}, ${b})`;\r\n};\r\n\r\n//Generate the color space using the color mapping suggested in the paper\r\nexport const pixelColor = (x, y, distance) => {\r\n  let r, g, b, a;\r\n  //atan2 out in [-pi, pi]\r\n  let angle = Math.atan2(y, x);\r\n  angle = -angle;\r\n  //we need it in [0, 2pi]\r\n  if (angle < 0) angle += 2 * Math.PI;\r\n\r\n  if (angle >= 0 && angle < math.pi / 3) {\r\n    r = 1;\r\n    g = (3 * angle) / math.pi;\r\n    b = 0;\r\n  } else if (angle >= math.pi / 3 && angle < (math.pi * 2) / 3) {\r\n    r = 2 - (3 * angle) / math.pi;\r\n    g = 1;\r\n    b = 0;\r\n  } else if (angle >= (math.pi * 2) / 3 && angle < math.pi) {\r\n    r = 0;\r\n    g = 1;\r\n    b = (3 * angle) / math.pi - 2;\r\n  } else if (angle >= math.pi && angle < (math.pi * 4) / 3) {\r\n    r = 0;\r\n    g = 4 - (3 * angle) / math.pi;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 4) / 3 && angle < (math.pi * 5) / 3) {\r\n    r = (3 * angle) / math.pi - 4;\r\n    g = 0;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 5) / 3 && angle < 2 * math.pi) {\r\n    r = 1;\r\n    g = 0;\r\n    b = 6 - (3 * angle) / math.pi;\r\n  }\r\n\r\n  r = contToDiscRGB(r);\r\n  g = contToDiscRGB(g);\r\n  b = contToDiscRGB(b);\r\n  a = contToDiscRGB(distance);\r\n\r\n  return { r, g, b, a };\r\n};\r\n\r\nexport function getRgbaFromComplex(complex) {\r\n  let polarComplex = complex.toPolar();\r\n  let angle = polarComplex.phi; // phi from [-pi, pi], but color mapping defined in [0,2pi]\r\n  let mod = polarComplex.r;\r\n\r\n  //negative angle mapped to their positive representation\r\n  if (angle < 0) angle += 2 * math.pi;\r\n\r\n  let ris = gradient(angle).slice(3, -1);\r\n\r\n  return `rgba${ris}, ${mod})`;\r\n}\r\n","import { Midi } from '@tonejs/midi';\r\nimport dft, { sumAndNormalize } from './DFT';\r\nimport { getRgbaFromComplex, pixelColor } from './colorMapping';\r\n\r\nclass Pcv {\r\n  constructor() {\r\n    this.C = 0;\r\n    this.Cs = 0;\r\n    this.D = 0;\r\n    this.Ds = 0;\r\n    this.E = 0;\r\n    this.F = 0;\r\n    this.Fs = 0;\r\n    this.G = 0;\r\n    this.Gs = 0;\r\n    this.A = 0;\r\n    this.As = 0;\r\n    this.B = 0;\r\n  }\r\n\r\n  addNoteDuration(targetPitch, duration) {\r\n    switch (targetPitch) {\r\n      case 'C':\r\n        this.C += duration;\r\n        break;\r\n      case 'C#':\r\n        this.Cs += duration;\r\n        break;\r\n      case 'D':\r\n        this.D += duration;\r\n        break;\r\n      case 'D#':\r\n        this.Ds += duration;\r\n        break;\r\n      case 'E':\r\n        this.E += duration;\r\n        break;\r\n      case 'F':\r\n        this.F += duration;\r\n        break;\r\n      case 'F#':\r\n        this.Fs += duration;\r\n        break;\r\n      case 'G':\r\n        this.G += duration;\r\n        break;\r\n      case 'G#':\r\n        this.Gs += duration;\r\n        break;\r\n      case 'A':\r\n        this.A += duration;\r\n        break;\r\n      case 'A#':\r\n        this.As += duration;\r\n        break;\r\n      case 'B':\r\n        this.B += duration;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  getPcvAsArray() {\r\n    let temp = [\r\n      this.C,\r\n      this.Cs,\r\n      this.D,\r\n      this.Ds,\r\n      this.E,\r\n      this.F,\r\n      this.Fs,\r\n      this.G,\r\n      this.Gs,\r\n      this.A,\r\n      this.As,\r\n      this.B,\r\n    ];\r\n\r\n    return temp;\r\n  }\r\n\r\n  add(pcv) {\r\n    this.C = pcv.C;\r\n    this.Cs = pcv.Cs;\r\n    this.D = pcv.D;\r\n    this.Ds = pcv.Ds;\r\n    this.E = pcv.E;\r\n    this.F = pcv.F;\r\n    this.Fs = pcv.Fs;\r\n    this.G = pcv.G;\r\n    this.Gs = pcv.Gs;\r\n    this.A = pcv.A;\r\n    this.As = pcv.As;\r\n    this.B = pcv.B;\r\n  }\r\n}\r\n\r\nexport function getMidiFileDataObject(binMidiFile) {\r\n  let midiData = new Midi(binMidiFile);\r\n\r\n  let tempos = midiData.header.tempos.map((tempo) => Math.round(tempo.bpm));\r\n  let midiBpm = Math.max(...tempos); //For quarter-note conversion\r\n\r\n  //Check and delete percussive tracks!\r\n  let nonPercussiveTracks = midiData.tracks.filter(\r\n    (track) => track.instrument.percussion === false\r\n  );\r\n\r\n  midiData.tracks = nonPercussiveTracks;\r\n\r\n  return { midiData, midiBpm };\r\n}\r\n\r\nexport function getDftCoeffStatic(midiFile, resolution) {\r\n  let tracksSubdivision = [];\r\n\r\n  midiFile.tracks.forEach((track) =>\r\n    tracksSubdivision.push(\r\n      getSubdivision(track.notes, resolution, midiFile.duration)\r\n    )\r\n  );\r\n  //console.log(tracksSubdivision);\r\n\r\n  //pcv arrary init\r\n  let pcvSubdivision = [];\r\n\r\n  for (let i = 0; i < tracksSubdivision[0].length; i++) {\r\n    pcvSubdivision.push(new Pcv());\r\n  }\r\n\r\n  //populating the array for each subdiv with the durations\r\n  //for each track: i, for each subdiv: j, for each note of the subdiv: k\r\n  for (let i = 0; i < tracksSubdivision.length; i++) {\r\n    for (let j = 0; j < tracksSubdivision[i].length; j++) {\r\n      for (let k = 0; k < tracksSubdivision[i][j].length; k++) {\r\n        let { pitch, duration } = tracksSubdivision[i][j][k];\r\n        pcvSubdivision[j].addNoteDuration(pitch, duration);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Computing the dft coeffs for of each subdiv\r\n  let dftCoeffsSubdivision = pcvSubdivision.map((pcv) =>\r\n    dft(pcv.getPcvAsArray())\r\n  );\r\n\r\n  //Computing the dft coeffs matrix\r\n  let dftCoeffsMatrix = [];\r\n\r\n  //adding the first row\r\n  dftCoeffsMatrix.push(dftCoeffsSubdivision);\r\n\r\n  return dftCoeffsMatrix;\r\n}\r\n\r\nexport function getDftCoeffDynamic(midiData, resolutionMode, currentSongBPM) {\r\n  let { noteResolutionValue, seconds, useSeconds } = resolutionMode;\r\n\r\n  let resolution;\r\n  if (useSeconds) {\r\n    isNaN(seconds) ? (resolution = 1) : (resolution = seconds);\r\n  } else {\r\n    //Use bpm\r\n    resolution = noteResolutionValue * (60 / currentSongBPM);\r\n  }\r\n\r\n  //console.log(currentSongBPM);\r\n  //console.log(resolution);\r\n\r\n  let duration = midiData.duration;\r\n  let tracksSubdivision = [];\r\n\r\n  //TODO: check and delete percussive tracks!\r\n  let nonPercussiveTracks = midiData.tracks.filter(\r\n    (track) => track.instrument.percussion === false\r\n  );\r\n\r\n  nonPercussiveTracks.forEach((track) => {\r\n    tracksSubdivision.push(getSubdivision(track.notes, resolution, duration));\r\n  });\r\n\r\n  //pcv arrary init\r\n  let pcvSubdivision = [];\r\n\r\n  for (let i = 0; i < tracksSubdivision[0].length; i++) {\r\n    pcvSubdivision.push(new Pcv());\r\n  }\r\n\r\n  //populating the array for each subdiv with the durations\r\n  //for each track: i, for each subdiv: j, for each note of the subdiv: k\r\n  for (let i = 0; i < tracksSubdivision.length; i++) {\r\n    for (let j = 0; j < tracksSubdivision[i].length; j++) {\r\n      for (let k = 0; k < tracksSubdivision[i][j].length; k++) {\r\n        let { pitch, duration } = tracksSubdivision[i][j][k];\r\n        pcvSubdivision[j].addNoteDuration(pitch, duration);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Computing the dft coeffs for of each subdiv\r\n  let dftCoeffsSubdivision = pcvSubdivision.map((pcv) =>\r\n    dft(pcv.getPcvAsArray())\r\n  );\r\n\r\n  //Computing the dft coeffs matrix\r\n  let dftCoeffsMatrix = [];\r\n\r\n  //adding the first row\r\n  dftCoeffsMatrix.push(dftCoeffsSubdivision);\r\n\r\n  //Subdividing the first row of the dft coeff matrix to get the trace for each coeff\r\n  let traces = [];\r\n  let firstRow = dftCoeffsMatrix[0];\r\n  for (let i = 1; i < 7; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < firstRow.length; j++) {\r\n      temp.push({ x: firstRow[j][i].re, y: firstRow[j][i].im });\r\n    }\r\n    traces.push(temp);\r\n  }\r\n\r\n  return { tracesData: traces, resolution: resolution };\r\n}\r\n\r\n//Resolution is in seconds\r\nexport function getDftCoeffFromMidiLinear(\r\n  midiFile,\r\n  multiRes = 1,\r\n  seconds = 1,\r\n  useSeconds\r\n) {\r\n  //For now, we don't take into account tempo changes\r\n  let midiData = new Midi(midiFile);\r\n  console.log(midiData);\r\n\r\n  let resolution;\r\n  if (useSeconds) {\r\n    isNaN(seconds) ? (resolution = 1) : (resolution = seconds);\r\n  } else {\r\n    //Use bpm\r\n    let tempos = midiData.header.tempos.map((tempo) => Math.round(tempo.bpm));\r\n    let bpm = Math.max(...tempos); //For quarter-note conversion\r\n    resolution = multiRes * (60 / bpm);\r\n  }\r\n\r\n  console.log(resolution);\r\n\r\n  let duration = midiData.duration;\r\n  let tracksSubdivision = [];\r\n\r\n  //TODO: check and delete percussive tracks!\r\n  let nonPercussiveTracks = midiData.tracks.filter(\r\n    (track) => track.instrument.percussion === false\r\n  );\r\n\r\n  nonPercussiveTracks.forEach((track) => {\r\n    tracksSubdivision.push(getSubdivision(track.notes, resolution, duration));\r\n  });\r\n\r\n  //pcv arrary init\r\n  let pcvSubdivision = [];\r\n\r\n  for (let i = 0; i < tracksSubdivision[0].length; i++) {\r\n    pcvSubdivision.push(new Pcv());\r\n  }\r\n\r\n  //populating the array for each subdiv with the durations\r\n  //for each track: i, for each subdiv: j, for each note of the subdiv: k\r\n  for (let i = 0; i < tracksSubdivision.length; i++) {\r\n    for (let j = 0; j < tracksSubdivision[i].length; j++) {\r\n      for (let k = 0; k < tracksSubdivision[i][j].length; k++) {\r\n        let { pitch, duration } = tracksSubdivision[i][j][k];\r\n        pcvSubdivision[j].addNoteDuration(pitch, duration);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Computing the dft coeffs for of each subdiv\r\n  let dftCoeffsSubdivision = pcvSubdivision.map((pcv) =>\r\n    dft(pcv.getPcvAsArray())\r\n  );\r\n\r\n  //Computing the dft coeffs matrix\r\n  let dftCoeffsMatrix = [];\r\n\r\n  //adding the first row\r\n  dftCoeffsMatrix.push(dftCoeffsSubdivision);\r\n\r\n  return { dftCoeffsLinear: dftCoeffsMatrix, resolution: resolution };\r\n}\r\n\r\n//Resolution is in seconds\r\nexport function getDftCoeffFromMidi(midiFile, resolution) {\r\n  //For now, we don't take into account tempo changes\r\n  let midiData = new Midi(midiFile);\r\n  console.log(midiData);\r\n  //const bpm = midiData.header.tempos[0].bpm; //For quarter-note conversion\r\n  let duration = midiData.duration;\r\n  let tracksSubdivision = [];\r\n\r\n  //TODO: check and delete percussive tracks!\r\n  let nonPercussiveTracks = midiData.tracks.filter(\r\n    (track) => track.instrument.percussion === false\r\n  );\r\n\r\n  /* midiData.tracks.forEach((track) => {\r\n    let tempMat = [];\r\n\r\n    for (let wndLen = resolution; wndLen < duration; wndLen += resolution) {\r\n      tempMat.push(getRow(track.notes, wndLen, resolution, duration));\r\n    }\r\n    //Since wndLen < duration, the for cycle do not include the top vertex of the triangle\r\n    tempMat.push(getRow(track.notes, duration, duration, duration)); //manually added\r\n\r\n    trackMatrices.push(tempMat);\r\n  }); */\r\n\r\n  nonPercussiveTracks.forEach((track) => {\r\n    tracksSubdivision.push(getSubdivision(track.notes, resolution, duration));\r\n  });\r\n\r\n  //pcv arrary init\r\n  let pcvSubdivision = [];\r\n\r\n  for (let i = 0; i < tracksSubdivision[0].length; i++) {\r\n    pcvSubdivision.push(new Pcv());\r\n  }\r\n\r\n  //populating the array for each subdiv with the durations\r\n  //for each track: i, for each subdiv: j, for each note of the subdiv: k\r\n  for (let i = 0; i < tracksSubdivision.length; i++) {\r\n    for (let j = 0; j < tracksSubdivision[i].length; j++) {\r\n      for (let k = 0; k < tracksSubdivision[i][j].length; k++) {\r\n        let { pitch, duration } = tracksSubdivision[i][j][k];\r\n        pcvSubdivision[j].addNoteDuration(pitch, duration);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Computing the dft coeffs for of each subdiv\r\n  let dftCoeffsSubdivision = pcvSubdivision.map((pcv) =>\r\n    dft(pcv.getPcvAsArray())\r\n  );\r\n\r\n  //Computing the dft coeffs matrix\r\n  let dftCoeffsMatrix = [];\r\n\r\n  //adding the first row\r\n  dftCoeffsMatrix.push(dftCoeffsSubdivision);\r\n\r\n  return dftCoeffsMatrix;\r\n\r\n  /* OLD   //Computing each row of the matrix as the normalized sum of the previous row (dft as linear op)\r\n  let matrixHeight = dftCoeffsSubdivision.length;\r\n  let rowsWidth = dftCoeffsSubdivision.length;\r\n  for (let i = 1; i < matrixHeight; i++) {\r\n    //starting from second row, first already populated\r\n    let temp = [];\r\n    for (let cursor = 1; cursor < rowsWidth; cursor++) {\r\n      //starting from the second element and backward summing\r\n      temp.push(\r\n        //TODO change, sum subdiv only on first row\r\n        sumAndNormalize(\r\n          dftCoeffsMatrix[i - 1][cursor - 1],\r\n          dftCoeffsMatrix[i - 1][cursor]\r\n        )\r\n      );\r\n    }\r\n    rowsWidth--;\r\n    dftCoeffsMatrix.push(temp);\r\n  } */\r\n}\r\n\r\nexport function getRgbaMatrix(dftCoeffsMatrix) {\r\n  //Computing each row of the matrix as the normalized sum of the previous row (dft as linear op)\r\n  let matrixHeight = dftCoeffsMatrix[0].length;\r\n  let rowsWidth = dftCoeffsMatrix[0].length;\r\n  let wndLenUnits = 2;\r\n  for (let i = 1; i < matrixHeight; i++) {\r\n    //starting from second row, first already populated\r\n    let temp = [];\r\n    for (let cursor = 0; cursor + wndLenUnits <= rowsWidth; cursor++) {\r\n      let windowed = dftCoeffsMatrix[0].slice(cursor, cursor + wndLenUnits);\r\n      temp.push(sumAndNormalize(windowed));\r\n    }\r\n    wndLenUnits++;\r\n    dftCoeffsMatrix.push(temp);\r\n  }\r\n\r\n  /* //Computing the pcvs for each subdivision\r\n  let pcvMatrix = [];\r\n\r\n  for (let i = 0; i < trackMatrices[0].length; i++) {\r\n    let temp = [];\r\n    for (let k = 0; k < trackMatrices[0][i].length; k++) {\r\n      temp.push(new Pcv());\r\n    }\r\n    pcvMatrix.push(temp);\r\n  } */\r\n\r\n  /* trackMatrices.forEach((track) => {\r\n    for (let i = 0; i < track.length; i++) {\r\n      for (let j = 0; j < track[i].length; j++) {\r\n        for (let k = 0; k < track[i][j].length; k++) {\r\n          let { pitch, duration } = track[i][j][k];\r\n          pcvMatrix[i][j].addNoteDuration(pitch, duration);\r\n        }\r\n      }\r\n    }\r\n  }); */\r\n\r\n  /* //Computing the dft coeff matrix\r\n  let dftCoeffMatrix = [];\r\n\r\n  for (let i = 0; i < pcvMatrix.length; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < pcvMatrix[i].length; j++) {\r\n      temp.push(dft(pcvMatrix[i][j].getPcvAsArray()));\r\n    }\r\n    dftCoeffMatrix.push(temp);\r\n  } */\r\n\r\n  let rgbaMatrices = [];\r\n\r\n  for (let i = 0; i < 6; i++) {\r\n    let matrix = [];\r\n    for (let j = 0; j < dftCoeffsMatrix.length; j++) {\r\n      let subdiv = [];\r\n      for (let k = 0; k < dftCoeffsMatrix[j].length; k++) {\r\n        subdiv.push('');\r\n      }\r\n      matrix.push(subdiv);\r\n    }\r\n    rgbaMatrices.push(matrix);\r\n  }\r\n\r\n  //Creating a single matrix for each coefficient with rgba values for each diamond\r\n  for (let i = 0; i < dftCoeffsMatrix.length; i++) {\r\n    for (let j = 0; j < dftCoeffsMatrix[i].length; j++) {\r\n      for (let k = 1; k < dftCoeffsMatrix[i][j].length; k++) {\r\n        rgbaMatrices[k - 1][i][j] = getRgbaFromComplex(\r\n          dftCoeffsMatrix[i][j][k]\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  return rgbaMatrices;\r\n}\r\n\r\nfunction getSubdivision(notes, resolution, duration) {\r\n  let subdivision = [];\r\n  let wndLen = resolution;\r\n\r\n  for (let cursor = 0; cursor < duration; cursor += resolution) {\r\n    let temp = [];\r\n    notes.forEach((note) => {\r\n      let { time, duration } = note;\r\n\r\n      //Check if note contribute to the current window\r\n      if (isValidNote(time, duration, cursor, wndLen)) {\r\n        let noteAndDuration = { pitch: note.pitch };\r\n        //Computation of note contribution in the current window\r\n        if (time < cursor) {\r\n          if (time + duration < cursor + wndLen)\r\n            noteAndDuration.duration = time + duration - cursor;\r\n          else noteAndDuration.duration = wndLen;\r\n        } else {\r\n          if (time + duration <= cursor + wndLen)\r\n            noteAndDuration.duration = duration;\r\n          else noteAndDuration.duration = cursor + wndLen - time;\r\n        }\r\n\r\n        temp.push(noteAndDuration);\r\n      }\r\n    });\r\n\r\n    subdivision.push(temp);\r\n  }\r\n\r\n  return subdivision;\r\n}\r\n\r\nfunction isValidNote(time, duration, cursor, wndLen) {\r\n  if (\r\n    (time > cursor && time < cursor + wndLen) ||\r\n    (time + duration > cursor && time + duration < cursor + wndLen) ||\r\n    (time <= cursor && time + duration >= cursor + wndLen)\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function getComplementaryColours(coeffs) {\r\n  let colours = [];\r\n\r\n  //Opposite of re and im to get the complementary colour\r\n  coeffs.forEach((coeff) => {\r\n    let rho = Math.sqrt(Math.pow(coeff.re, 2) + Math.pow(coeff.im, 2));\r\n    let rgba = pixelColor(coeff.re, -coeff.im, rho);\r\n\r\n    //RGB complementary\r\n    rgba.r = 255 - rgba.r;\r\n    rgba.g = 255 - rgba.g;\r\n    rgba.b = 255 - rgba.b;\r\n\r\n    colours.push(rgbaToHexa(rgba));\r\n  });\r\n\r\n  return colours;\r\n}\r\n\r\nfunction rgbaToHexa(rgba) {\r\n  let hexa = Object.keys(rgba).map((key) => colorToHex(rgba[key]));\r\n  return `#${hexa.join('')}`;\r\n}\r\n\r\nfunction colorToHex(color) {\r\n  let hexadecimal = color.toString(16);\r\n  return hexadecimal.length == 1 ? '0' + hexadecimal : hexadecimal;\r\n}\r\n","export function getRosePoints(n, d) {\r\n  let dataPoints = [];\r\n\r\n  for (let delta = 0; delta < 2 * Math.PI * d; delta += 0.01) {\r\n    let r = 10 * Math.cos((n / d) * delta);\r\n    let x = r * Math.cos(delta);\r\n    let y = r * Math.sin(delta);\r\n\r\n    dataPoints.push([x, y]);\r\n  }\r\n\r\n  return dataPoints;\r\n}\r\n","export default __webpack_public_path__ + \"static/media/whole.69e31bd8.svg\";","export default __webpack_public_path__ + \"static/media/half.7d756528.svg\";","export default __webpack_public_path__ + \"static/media/quarter.a35808dc.svg\";","export default __webpack_public_path__ + \"static/media/eighth.347a1769.svg\";","export default __webpack_public_path__ + \"static/media/sixteenth.91907e68.svg\";","import { useRef, useState } from 'react';\r\n\r\nimport Radio from '@mui/material/Radio';\r\nimport RadioGroup from '@mui/material/RadioGroup';\r\nimport FormControl from '@mui/material/FormControl';\r\nimport FormLabel from '@mui/material/FormLabel';\r\nimport FormControlLabel from '@mui/material/FormControlLabel';\r\nimport TextField from '@mui/material/TextField';\r\nimport Box from '@mui/material/Box';\r\nimport Button from '@mui/material/Button';\r\nimport Typography from '@mui/material/Typography';\r\n\r\nimport wholeSvg from './svgNotation/whole.svg';\r\nimport halfSvg from './svgNotation/half.svg';\r\nimport quarterSvg from './svgNotation/quarter.svg';\r\nimport eighthSvg from './svgNotation/eighth.svg';\r\nimport sixteenthSvg from './svgNotation/sixteenth.svg';\r\n\r\nfunction ResolutionSelector({\r\n  resolutionMode,\r\n  setResolutionMode,\r\n  retriggerAnalysis,\r\n}) {\r\n  //State: input error\r\n  const [isInputSecondsInvalid, setIsInputSecondsInvalid] = useState(false);\r\n  const resolutionTextRef = useRef(null);\r\n\r\n  function onChangeResolutionSelection(event) {\r\n    let newResolutionMode = { ...resolutionMode };\r\n    newResolutionMode.seconds = parseFloat(resolutionTextRef.current.value);\r\n\r\n    switch (event.target.value) {\r\n      case 'sixteenth':\r\n        newResolutionMode.noteResolutionValue = 0.25;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'eighth':\r\n        newResolutionMode.noteResolutionValue = 0.5;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'quarter':\r\n        newResolutionMode.noteResolutionValue = 1;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'half':\r\n        newResolutionMode.noteResolutionValue = 2;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'whole':\r\n        newResolutionMode.noteResolutionValue = 4;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'seconds':\r\n        newResolutionMode.useSeconds = true;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    setResolutionMode(newResolutionMode);\r\n  }\r\n\r\n  return (\r\n    <Box>\r\n      <FormControl component='fieldset'>\r\n        <RadioGroup\r\n          row\r\n          defaultValue='quarter'\r\n          onChange={onChangeResolutionSelection}\r\n          aria-label='resolution'\r\n          name='row-radio-buttons-group'\r\n          sx={{ display: 'flex', justifyContent: 'space-between' }}\r\n        >\r\n          <FormControlLabel\r\n            value='sixteenth'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <img\r\n                style={{\r\n                  width: 10,\r\n                  height: 10,\r\n                  transform: 'scale(3, 3)',\r\n                }}\r\n                src={sixteenthSvg}\r\n              />\r\n            }\r\n          />\r\n          <FormControlLabel\r\n            value='eighth'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <img\r\n                style={{\r\n                  width: 10,\r\n                  height: 10,\r\n                  transform: 'scale(3, 3) translate(0, 0)',\r\n                }}\r\n                src={eighthSvg}\r\n              />\r\n            }\r\n          />\r\n          <FormControlLabel\r\n            value='quarter'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <img\r\n                style={{\r\n                  width: 10,\r\n                  height: 10,\r\n                  marginTop: 8,\r\n                  transform: 'scale(1, 3)',\r\n                }}\r\n                src={quarterSvg}\r\n              />\r\n            }\r\n          />\r\n          <FormControlLabel\r\n            value='half'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <img\r\n                style={{\r\n                  width: 10,\r\n                  height: 10,\r\n                  marginTop: 8,\r\n                  transform: 'scale(3.7, 3.2) ',\r\n                }}\r\n                src={halfSvg}\r\n              />\r\n            }\r\n          />\r\n          <FormControlLabel\r\n            value='whole'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <img\r\n                style={{\r\n                  width: 10,\r\n                  height: 10,\r\n                  marginTop: 0,\r\n                  transform: 'scale(1.5, 1)',\r\n                }}\r\n                src={wholeSvg}\r\n              />\r\n            }\r\n          />\r\n\r\n          <FormControlLabel\r\n            value='seconds'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <TextField\r\n                sx={{ minHeight: '4.4rem', maxWidth: '5rem' }}\r\n                error={isInputSecondsInvalid}\r\n                helperText={isInputSecondsInvalid && 'Invalid input'}\r\n                label='in seconds'\r\n                id='standard-size-small'\r\n                defaultValue='1.5'\r\n                size='small'\r\n                variant='standard'\r\n                onChange={() => {\r\n                  let newResolutionMode = { ...resolutionMode };\r\n                  newResolutionMode.seconds = parseFloat(\r\n                    resolutionTextRef.current.value\r\n                  );\r\n                  if (isNaN(newResolutionMode.seconds))\r\n                    setIsInputSecondsInvalid(true);\r\n                  else {\r\n                    setResolutionMode(newResolutionMode);\r\n                    setIsInputSecondsInvalid(false);\r\n                  }\r\n                }}\r\n                inputRef={resolutionTextRef}\r\n              />\r\n            }\r\n          />\r\n          <Button\r\n            variant='contained'\r\n            onClick={retriggerAnalysis}\r\n            sx={{ width: '22%', height: '15%', marginTop: 2 }}\r\n          >\r\n            Change\r\n          </Button>\r\n        </RadioGroup>\r\n      </FormControl>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default ResolutionSelector;\r\n","import { styled } from '@mui/material/styles';\r\nimport Chip from '@mui/material/Chip';\r\nimport Paper from '@mui/material/Paper';\r\n\r\nconst ListItem = styled('li')(({ theme }) => ({\r\n  margin: theme.spacing(0.5),\r\n}));\r\n\r\nexport default function PcvChipsBox({ userPcvs, setUserPcvs, rosesMat }) {\r\n  const handleDelete = (chipToDelete) => () => {\r\n    //on detele, set the rose icon to unused\r\n    //matrix coeffs are i = d-1, j=d-1\r\n    rosesMat[chipToDelete.d - 1][chipToDelete.n - 1].used = false;\r\n\r\n    setUserPcvs((chips) =>\r\n      chips.filter((chip) => chip.label !== chipToDelete.label)\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Paper\r\n      sx={{\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        flexWrap: 'wrap',\r\n        listStyle: 'none',\r\n        p: '3px',\r\n        overflow: 'auto',\r\n        height: '100%',\r\n        width: '100%',\r\n      }}\r\n      component='ul'\r\n    >\r\n      {userPcvs.map((data, i) => {\r\n        return (\r\n          <ListItem key={`${i}`}>\r\n            <Chip\r\n              variant={data.isDisabled ? 'outlined' : 'filled'}\r\n              icon={\r\n                <svg\r\n                  xmlns='http://www.w3.org/2000/svg'\r\n                  width='24'\r\n                  height='24'\r\n                  viewBox='0 0 24 24'\r\n                >\r\n                  <g /* fill='none' fill-rule='evenodd' */>\r\n                    {/* <rect\r\n                      width='20'\r\n                      height='20'\r\n                      x='2'\r\n                      y='2'\r\n                      fill='#FFF'\r\n                      rx='10'\r\n                    /> */}\r\n                    <polyline\r\n                      transform={`translate(${12},${12})`}\r\n                      fill='none'\r\n                      stroke='black'\r\n                      strokeWidth='1px'\r\n                      points={data.rosePoints}\r\n                    />\r\n                  </g>\r\n                </svg>\r\n              }\r\n              label={data.label}\r\n              onDelete={handleDelete(data)}\r\n              onClick={() => {\r\n                data.isDisabled = !data.isDisabled;\r\n                setUserPcvs([...userPcvs]);\r\n              }}\r\n            />\r\n          </ListItem>\r\n        );\r\n      })}\r\n    </Paper>\r\n  );\r\n}\r\n","import * as React from 'react';\r\nimport ReactMarkdown from 'markdown-to-jsx';\r\nimport Typography from '@mui/material/Typography';\r\n/* import { Link } from 'react-router-dom'; */\r\nimport Link from '@mui/material/Link';\r\nimport Box from '@mui/material/Box';\r\n\r\nfunction MarkdownListItem(props) {\r\n  return <Box component='li' sx={{ mt: 1, typography: 'body1' }} {...props} />;\r\n}\r\n\r\nfunction LinkReference({ to, ...props }) {\r\n  const myRef = React.useRef(null);\r\n\r\n  //Check for reference links, prevent default to not reload the page\r\n  //and scrollIntoView to focus on the footer when clicked\r\n  if (!isNaN(parseInt(props.href[1]))) {\r\n    return (\r\n      <Link\r\n        ref={myRef}\r\n        onClick={(event) => {\r\n          event.preventDefault();\r\n          myRef.current.scrollIntoView({\r\n            behavior: 'smooth',\r\n          });\r\n        }}\r\n        {...props}\r\n        id={`reference${props.href[1]}`}\r\n        href={`/#${props.href[1]}`}\r\n      />\r\n    );\r\n  } else return <Link {...props} />; //Else it is a normal external link\r\n}\r\n\r\nconst options = {\r\n  overrides: {\r\n    h1: {\r\n      component: Typography,\r\n      props: {\r\n        gutterBottom: true,\r\n        variant: 'h4',\r\n        component: 'h1',\r\n      },\r\n    },\r\n    h2: {\r\n      component: Typography,\r\n      props: { gutterBottom: true, variant: 'h6', component: 'h2' },\r\n    },\r\n    h3: {\r\n      component: Typography,\r\n      props: { gutterBottom: true, variant: 'subtitle1' },\r\n    },\r\n    h4: {\r\n      component: Typography,\r\n      props: {\r\n        gutterBottom: true,\r\n        variant: 'caption',\r\n        paragraph: true,\r\n      },\r\n    },\r\n    p: {\r\n      component: Typography,\r\n      props: { paragraph: true },\r\n    },\r\n    a: {\r\n      component: LinkReference,\r\n    },\r\n    li: {\r\n      component: MarkdownListItem,\r\n    },\r\n  },\r\n};\r\n\r\nexport default function Markdown(props) {\r\n  return <ReactMarkdown options={options} {...props} />;\r\n}\r\n","export default \"data:image/png;base64,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\"","import React from 'react';\r\n\r\nimport logo from './logos/placeholder.png';\r\n\r\nimport Stack from '@mui/material/Stack';\r\nimport Box from '@mui/material/Box';\r\nimport Typography from '@mui/material/Typography';\r\nimport Link from '@mui/material/Link';\r\n\r\nfunction Footer() {\r\n  let logoSize = 100;\r\n  return (\r\n    <Box sx={{ marginTop: 1, textAlign: 'center' }}>\r\n      <Stack sx={{ justifyContent: 'center' }} direction='row'>\r\n        <img width={logoSize} height={logoSize} src={logo} />\r\n        <img width={logoSize} height={logoSize} src={logo} />\r\n        <img width={logoSize} height={logoSize} src={logo} />\r\n      </Stack>\r\n      <Typography>\r\n        Project “Enabling interactive music visualization for a wider community”\r\n      </Typography>\r\n      <Stack sx={{ justifyContent: 'center' }} direction='row'>\r\n        <Typography sx={{ marginRight: 1 }}>\r\n          Project lead: Fabian C. Moss; Daniel Harasim\r\n        </Typography>\r\n        <span>{`\\u2013`}</span>\r\n        <Typography sx={{ marginLeft: 1 }}>\r\n          Developer: Giovanni Affatato\r\n        </Typography>\r\n      </Stack>\r\n      <Stack sx={{ justifyContent: 'center' }} direction='row'>\r\n        <Link sx={{ marginRight: 1 }} href='https://github.com/DCMLab/MIDFT'>\r\n          GitHub repo\r\n        </Link>\r\n        <span>{`\\u2022`}</span>\r\n        <Link\r\n          sx={{ marginLeft: 1, marginRight: 1 }}\r\n          href='https://www.epfl.ch/labs/dcml/'\r\n        >\r\n          DCML page\r\n        </Link>\r\n        <span>{`\\u2022`}</span>\r\n        <Typography sx={{ marginLeft: 1 }} href=''>\r\n          Copyright\r\n        </Typography>\r\n      </Stack>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default Footer;\r\n","export default __webpack_public_path__ + \"static/media/HomeMarkdown.4682608b.md\";","import { useEffect, useState } from 'react';\r\n\r\nimport Paper from '@mui/material/Paper';\r\nimport Markdown from '../Markdown';\r\nimport Box from '@mui/material/Box';\r\nimport Footer from '../Footer';\r\nimport HomeMarkdown from '../HomeMarkdown.md';\r\n/* import Markdown from '../Markdown'; */\r\n\r\nexport default function Home({ setOpen, setInAnalysisPage }) {\r\n  const [content, setContent] = useState(``);\r\n\r\n  useEffect(() => {\r\n    setInAnalysisPage(false);\r\n    setOpen(false);\r\n\r\n    //Fetch the text of the markdown file as a string\r\n    fetch(HomeMarkdown)\r\n      .then((response) => response.text())\r\n      .then((text) => {\r\n        setContent(text);\r\n      });\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <Paper sx={{ margin: 'auto', maxWidth: '1200px' }}>\r\n        <Box sx={{ padding: 3 }}>\r\n          <Markdown>{content}</Markdown>\r\n        </Box>\r\n      </Paper>\r\n      <Footer />\r\n    </>\r\n  );\r\n}\r\n","export default __webpack_public_path__ + \"static/media/TheoryMarkdown.26c0a4ee.md\";","import { useEffect, useState } from 'react';\r\n\r\nimport Paper from '@mui/material/Paper';\r\n\r\nimport Box from '@mui/material/Box';\r\nimport Footer from '../Footer';\r\nimport TheoryMarkdown from '../TheoryMarkdown.md';\r\nimport Markdown from '../Markdown';\r\nimport Tex from '@matejmazur/react-katex';\r\nimport 'katex/dist/katex.min.css';\r\n\r\nconst testContent = `\r\nGiven a **formula** below\r\n$$\r\ns = ut + \\\\frac{1}{2}at^{2}\r\n$$\r\nCalculate the value of $s$ when $u = 10\\\\frac{m}{s}$ and $a = 2\\\\frac{m}{s^{2}}$ at $t = 1s$\r\n`;\r\n\r\nconst testRemark = `**Below me will be displayed as a block:**\r\n$$ \r\nBlock Math \r\n$$\r\n**Next to me will be displayed as inline ->** $Inline Math$`;\r\n\r\nexport default function Theory({ setOpen, setInAnalysisPage }) {\r\n  const [content, setContent] = useState(``);\r\n\r\n  useEffect(() => {\r\n    setInAnalysisPage(false);\r\n    setOpen(false);\r\n\r\n    //Fetch the text of the markdown file as a string\r\n    fetch(TheoryMarkdown)\r\n      .then((response) => response.text())\r\n      .then((text) => {\r\n        setContent(text);\r\n      });\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <Paper sx={{ margin: 'auto', maxWidth: '1200px' }}>\r\n        <Box sx={{ padding: 3 }}>\r\n          <Markdown>{content}</Markdown>\r\n          <Markdown>{`TEST Given a **formula** below`}</Markdown>\r\n          <Tex math='s = ut + \\frac{1}{2}at^{2}' block />\r\n          <Markdown>{`TEST Given this **inline formula** `}</Markdown>\r\n          <Tex math=' s = ut + \\frac{1}{2}at^{2}' />\r\n          <Markdown>{` I can continue writing on the same line`}</Markdown>\r\n        </Box>\r\n      </Paper>\r\n      <Footer />\r\n    </>\r\n  );\r\n}\r\n","import { useRef, useEffect, useState } from 'react';\r\n\r\nconst verticalScale = Math.sin(Math.PI / 3);\r\n\r\nexport const Wavescape = ({\r\n  wsNumber,\r\n  wavescapeMatrix,\r\n  currentWavescapeSubdiv,\r\n  wavescapeWidth,\r\n}) => {\r\n  const canvasRef = useRef(null);\r\n  const [wsCoordinates, setWsCoordinates] = useState([]);\r\n  const margin = 10;\r\n  let width = wavescapeWidth - margin;\r\n  let height = wavescapeWidth;\r\n  let ticks;\r\n  const [ticksHeight, setTicksHeight] = useState(3);\r\n\r\n  useEffect(() => {\r\n    width = wavescapeWidth;\r\n    height = wavescapeWidth;\r\n    ticksHeight < 1\r\n      ? setTicksHeight(1)\r\n      : setTicksHeight(Math.floor(0.01 * wavescapeWidth));\r\n  }, [wavescapeWidth]);\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    // increase the actual size of our canvas\r\n    //canvas.width = width * devicePixelRatio;\r\n    //canvas.height = height * devicePixelRatio;\r\n\r\n    // ensure all drawing operations are scaled\r\n    //ctx.scale(devicePixelRatio, devicePixelRatio);\r\n\r\n    // scale everything down using CSS\r\n    //canvas.style.width = width + 'px';\r\n    //canvas.style.height = height + 'px';\r\n\r\n    let margins = [margin, margin];\r\n    let innerSize = [canvas.width - margins[0], canvas.height - margins[1]];\r\n    let baseSubdivision;\r\n\r\n    if (wavescapeMatrix) {\r\n      baseSubdivision = wavescapeMatrix[0].length;\r\n      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n      //ctx.setTransform(1, 0, 0, -1, 0, ctx.canvas.height);\r\n      ticks = computeTicks(\r\n        innerSize[0],\r\n        innerSize[1],\r\n        baseSubdivision,\r\n        margins[0],\r\n        margins[1]\r\n      );\r\n\r\n      setWsCoordinates(ticks);\r\n\r\n      //Vertical scaling to make the triangle equilateral\r\n      //ctx.scale(1, verticalScale);\r\n      drawWavescape(ticks, ctx, wavescapeMatrix);\r\n    }\r\n  }, [wavescapeMatrix, width, height]);\r\n\r\n  return (\r\n    <svg\r\n      id={`wavescape${wsNumber}`}\r\n      width={width + margin}\r\n      height={height}\r\n      xmlns='http://www.w3.org/2000/svg'\r\n    >\r\n      <g transform={`translate(${width * 0.06},${width * 0.1})`}>\r\n        <circle cx='5%' cy='1%' r={`${(width / 100) * 2.8}px`} fill='black' />\r\n        <text\r\n          fontSize={`${(width / 100) * 5.2}px`}\r\n          textAnchor='middle'\r\n          x='5%'\r\n          y='2.8%'\r\n          fill='white'\r\n        >\r\n          {wsNumber}\r\n        </text>\r\n      </g>\r\n      <g\r\n        transform={`scale(${1}, ${-verticalScale}) translate(${0},${-height})`}\r\n      >\r\n        <foreignObject x={0} y={0} width={width} height={height}>\r\n          <canvas width={width} height={height} ref={canvasRef}></canvas>\r\n        </foreignObject>\r\n\r\n        {/* //Line ticks */}\r\n        {wsCoordinates.length > 0\r\n          ? wsCoordinates[0].map((coord, i) => (\r\n              <line\r\n                key={`tick${i}`}\r\n                x1={coord.x}\r\n                x2={coord.x}\r\n                y1={coord.y - ticksHeight}\r\n                y2={coord.y + ticksHeight}\r\n                stroke='grey'\r\n                strokeWidth='1px'\r\n              />\r\n            ))\r\n          : null}\r\n        {/* Contour line */}\r\n        {wsCoordinates.length > 0 ? (\r\n          <>\r\n            <line\r\n              x1={wsCoordinates[0][0].x}\r\n              x2={wsCoordinates[0][wsCoordinates[0].length - 1].x}\r\n              y1={wsCoordinates[0][0].y}\r\n              y2={wsCoordinates[0][wsCoordinates[0].length - 1].y}\r\n              stroke='grey'\r\n              strokeWidth='2px'\r\n            />\r\n            <line\r\n              x1={wsCoordinates[0][wsCoordinates[0].length - 1].x}\r\n              x2={wsCoordinates[wsCoordinates.length - 1][0].x}\r\n              y1={wsCoordinates[0][wsCoordinates[0].length - 1].y}\r\n              y2={wsCoordinates[wsCoordinates.length - 1][0].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n            <line\r\n              x1={wsCoordinates[0][0].x}\r\n              x2={wsCoordinates[wsCoordinates.length - 1][0].x}\r\n              y1={wsCoordinates[0][0].y}\r\n              y2={wsCoordinates[wsCoordinates.length - 1][0].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n            <circle\r\n              cx={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].x +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].x) /\r\n                2\r\n              }\r\n              cy={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].y +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].y) /\r\n                2\r\n              }\r\n              r={0.01 * width}\r\n              fill='white'\r\n            />\r\n            <circle\r\n              cx={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].x +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].x) /\r\n                2\r\n              }\r\n              cy={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].y +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].y) /\r\n                2\r\n              }\r\n              r={0.01 * width}\r\n              stroke='black'\r\n              strokeWidth={1}\r\n              fill='transparent'\r\n            />\r\n          </>\r\n        ) : null}\r\n      </g>\r\n    </svg>\r\n  );\r\n};\r\n\r\nfunction computeTicks(\r\n  innerWidth,\r\n  innerHeight,\r\n  baseSubdivision,\r\n  marginLeft,\r\n  marginTop\r\n) {\r\n  //Actually, it is a square matrix\r\n  let unit = innerWidth / baseSubdivision;\r\n  let mat = [];\r\n\r\n  for (let i = 0; i < baseSubdivision + 1; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < baseSubdivision + 1; j++) {\r\n      if (i <= j)\r\n        temp.push({\r\n          x: (j - i) * unit + (i * unit) / 2 + marginLeft,\r\n          y: i * unit + marginTop,\r\n        });\r\n    }\r\n    mat.push(temp);\r\n  }\r\n\r\n  return mat;\r\n}\r\n\r\nfunction drawWavescape(ticks, ctx, wavescapeMatrix) {\r\n  for (let i = 0; i < ticks.length - 1; i++) {\r\n    for (let j = 0; j < ticks[i].length - 1; j++) {\r\n      if (i === 0) {\r\n        //first row composed by triangles\r\n        ctx.beginPath();\r\n        ctx.moveTo(ticks[i][j].x, ticks[i][j].y);\r\n        ctx.lineTo(ticks[i][j + 1].x, ticks[i][j + 1].y);\r\n        ctx.lineTo(ticks[i + 1][j].x, ticks[i + 1][j].y);\r\n        ctx.fillStyle = wavescapeMatrix[i][j];\r\n        ctx.fill();\r\n      } else {\r\n        //other rows composed by diamonds\r\n        ctx.beginPath();\r\n        ctx.moveTo(ticks[i][j].x, ticks[i][j].y);\r\n        ctx.lineTo(ticks[i - 1][j + 1].x, ticks[i - 1][j + 1].y);\r\n        ctx.lineTo(ticks[i][j + 1].x, ticks[i][j + 1].y);\r\n        ctx.lineTo(ticks[i + 1][j].x, ticks[i + 1][j].y);\r\n        ctx.fillStyle = wavescapeMatrix[i][j];\r\n        ctx.fill();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Wavescape } from './Wavescape';\r\n\r\nimport Box from '@mui/material/Box';\r\nimport { Typography } from '@mui/material';\r\n\r\nfunction WavescapeModule({\r\n  wavescapesData,\r\n  currentWavescapeSubdiv,\r\n  elemsWidth,\r\n}) {\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-around',\r\n      }}\r\n    >\r\n      {wavescapesData.length > 0 ? (\r\n        wavescapesData.map((data, i) => (\r\n          <Wavescape\r\n            wsNumber={i + 1}\r\n            key={`w.${i}`}\r\n            wavescapeMatrix={data}\r\n            currentWavescapeSubdiv={currentWavescapeSubdiv}\r\n            wavescapeWidth={elemsWidth}\r\n          />\r\n        ))\r\n      ) : (\r\n        <Typography color='error'>No midi file uploaded</Typography>\r\n      )}\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default WavescapeModule;\r\n","import * as d3 from 'd3';\r\nimport { useRef, useEffect, useState } from 'react';\r\nimport { pixelColor } from './colorMapping';\r\nimport Tooltip from '@mui/material/Tooltip';\r\nimport Typography from '@mui/material/Typography';\r\nimport Stack from '@mui/material/Stack';\r\nimport Box from '@mui/material/Box';\r\n\r\nlet savedImage = null;\r\n\r\n//Minus before every y coordinate due to the fact that svg has positive y\r\n//downward, meanwhile cartesian plane has positive y upward\r\n\r\nfunction Circle({\r\n  coeffNumber,\r\n  protoDataCoeff,\r\n  fullTrace,\r\n  traceDataCoeff,\r\n  userPcvsCoeff,\r\n  currentSubdiv,\r\n  performanceCoeff,\r\n  targetCircleWidth,\r\n  showMagAndPhase,\r\n  showFullTrace,\r\n}) {\r\n  const canvasRef = useRef(null);\r\n  const [currentSubdivCoeff, setCurrentSubdivCoeff] = useState({\r\n    mu: 0,\r\n    phi: 0,\r\n  });\r\n  let width = 445;\r\n  let height = width;\r\n\r\n  const margin = 45;\r\n  const headerOffset = 15;\r\n  const circleRadius = width / 2 - margin;\r\n\r\n  let marksRadiusRatio = 0.01;\r\n\r\n  useEffect(() => {\r\n    if (traceDataCoeff && traceDataCoeff[currentSubdiv]) {\r\n      //Rounding to second decimal and converting to polar coordinate\r\n      let x = traceDataCoeff[currentSubdiv].x;\r\n      let y = traceDataCoeff[currentSubdiv].y;\r\n\r\n      setCurrentSubdivCoeff(cartesianToPolar(x, y));\r\n    }\r\n  }, [currentSubdiv, traceDataCoeff]);\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n    let radius = Math.floor(circleRadius * devicePixelRatio);\r\n    let image = ctx.createImageData(2 * radius, 2 * radius);\r\n    let data = image.data;\r\n\r\n    // increase the actual size of our canvas\r\n    canvas.width = width * devicePixelRatio;\r\n    canvas.height = height * devicePixelRatio;\r\n\r\n    // ensure all drawing operations are scaled\r\n    ctx.scale(devicePixelRatio, devicePixelRatio);\r\n\r\n    // scale everything down using CSS\r\n    canvas.style.width = width + 'px';\r\n    canvas.style.height = height + 'px';\r\n\r\n    if (!savedImage) {\r\n      for (let x = -radius; x < radius; x++) {\r\n        for (let y = -radius; y < radius; y++) {\r\n          let distance = Math.sqrt(x * x + y * y);\r\n\r\n          if (distance > radius) {\r\n            // skip all (x,y) coordinates that are outside of the circle\r\n            continue;\r\n          }\r\n          // Figure out the starting index of this pixel in the image data array.\r\n          let rowLength = 2 * radius;\r\n          let adjustedX = x + radius; // convert x from [-50, 50] to [0, 100] (the coordinates of the image data array)\r\n          let adjustedY = y + radius; // convert y from [-50, 50] to [0, 100] (the coordinates of the image data array)\r\n          let pixelWidth = 4; // each pixel requires 4 slots in the data array\r\n          let index = (adjustedX + adjustedY * rowLength) * pixelWidth;\r\n          let rgba = pixelColor(x, y, distance / radius);\r\n          data[index] = rgba.r;\r\n          data[index + 1] = rgba.g;\r\n          data[index + 2] = rgba.b;\r\n          data[index + 3] = rgba.a;\r\n        }\r\n      }\r\n      savedImage = image;\r\n    }\r\n    ctx.putImageData(savedImage, 0, 0);\r\n\r\n    if (showFullTrace && traceDataCoeff) {\r\n      ctx.save();\r\n      ctx.translate((400 - margin) / 2, (400 - margin) / 2);\r\n      drawTrace();\r\n      ctx.restore();\r\n    }\r\n  }, [width, height, circleRadius, traceDataCoeff, showFullTrace]);\r\n\r\n  useEffect(() => {\r\n    //Workaround for chrome bug on canvas overlay in foreignObj SVG\r\n    canvasRef.current.getContext('2d').getImageData(0, 0, 1, 1);\r\n  }, []);\r\n\r\n  {\r\n    /* {traceDataCoeff\r\n          ? traceDataCoeff.map((pcv, i) =>\r\n              circleMark(pcv, marksRadiusRatio, 'black', i, 0.1)\r\n            )\r\n          : null} */\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (traceDataCoeff) {\r\n      const canvas = canvasRef.current;\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.save();\r\n      ctx.translate((400 - margin) / 2, (400 - margin) / 2);\r\n      drawTrace();\r\n      ctx.restore();\r\n    }\r\n  }, [fullTrace]);\r\n\r\n  function cartesianToPolar(x, y, norm = false) {\r\n    let phi = (Math.atan2(y, x) * 180) / Math.PI;\r\n    let mu = Math.sqrt(x * x + y * y);\r\n\r\n    if (norm) mu = mu / circleRadius;\r\n\r\n    phi = Math.round(phi + Number.EPSILON);\r\n    mu = Math.round((mu + Number.EPSILON) * 100) / 100;\r\n\r\n    return { mu, phi };\r\n  }\r\n\r\n  function drawTrace() {\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';\r\n\r\n    //traceDataCoeff to visualze the smoothing, fullTrace otherwise\r\n    traceDataCoeff.forEach((element) => {\r\n      ctx.beginPath();\r\n      ctx.arc(\r\n        element.x * circleRadius,\r\n        -element.y * circleRadius,\r\n        (marksRadiusRatio * width) / 2,\r\n        0,\r\n        Math.PI * 2,\r\n        true\r\n      );\r\n      ctx.fill();\r\n    });\r\n  }\r\n\r\n  const circleMark = (pcvData, radiusScaleWidth, color, id, opacity = 1) => {\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius(0)\r\n      .outerRadius((radiusScaleWidth * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    return (\r\n      <path\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n        fill={color}\r\n        fillOpacity={opacity}\r\n        key={id}\r\n        d={mark()}\r\n      ></path>\r\n    );\r\n  };\r\n\r\n  const crossMark = (pcvData, radiusScaleWidth) => {\r\n    return (\r\n      <g\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n      >\r\n        <line\r\n          x1='0'\r\n          x2='0'\r\n          y1='7'\r\n          y2='-7'\r\n          stroke='black'\r\n          strokeWidth='1.5'\r\n        ></line>\r\n        <line\r\n          x1='7'\r\n          x2='-7'\r\n          y1='0'\r\n          y2='0'\r\n          stroke='black'\r\n          strokeWidth='1.5'\r\n        ></line>\r\n      </g>\r\n    );\r\n  };\r\n\r\n  function svgRoseIcon(label, rosePoints, translateX, translateY, scale, i) {\r\n    let polarCoord = cartesianToPolar(translateX, translateY, true);\r\n    let widthSvg = 40;\r\n    return (\r\n      <Tooltip\r\n        key={`rtt.${i}`}\r\n        placement='top'\r\n        arrow\r\n        title={\r\n          <Stack\r\n            direction='row'\r\n            justifyContent='center'\r\n            alignItems='center'\r\n            spacing={2}\r\n          >\r\n            <svg\r\n              width={widthSvg}\r\n              height={widthSvg}\r\n              viewBox={`0 0 ${widthSvg} ${widthSvg}`}\r\n            >\r\n              <circle\r\n                cx={widthSvg / 2}\r\n                cy={widthSvg / 2}\r\n                r={widthSvg / 2}\r\n                strokeWidth='1'\r\n                fill='#FFF'\r\n                fillOpacity={1}\r\n              ></circle>\r\n\r\n              <polyline\r\n                transform={`translate(${widthSvg / 2},${\r\n                  widthSvg / 2\r\n                }) scale(${1.8})`}\r\n                fill='none'\r\n                stroke='black'\r\n                strokeWidth='1px'\r\n                points={rosePoints}\r\n              />\r\n            </svg>\r\n            <Stack>\r\n              <Typography>{label}</Typography>\r\n              <Typography>{`\\u{3BC}: ${\r\n                polarCoord.mu\r\n              } \\u{3C6}: ${-polarCoord.phi}\\u{b0}`}</Typography>\r\n            </Stack>\r\n          </Stack>\r\n        }\r\n      >\r\n        <g>\r\n          <polyline\r\n            transform={`translate(${translateX},${translateY}) scale(${scale})`}\r\n            fill='none'\r\n            stroke='black'\r\n            strokeWidth='1px'\r\n            fill='#FFF'\r\n            fillOpacity={0}\r\n            points={rosePoints}\r\n          />\r\n\r\n          <polyline\r\n            transform={`translate(${translateX},${translateY}) scale(${scale})`}\r\n            fill='none'\r\n            stroke='black'\r\n            strokeWidth='1px'\r\n            points={rosePoints}\r\n          />\r\n        </g>\r\n      </Tooltip>\r\n    );\r\n  }\r\n\r\n  const protoCircleMark = (pcvData, id) => {\r\n    let scaleRatio = 0.02;\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius((scaleRatio * width) / 2)\r\n      .outerRadius(((scaleRatio + 0.01) * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    //Check for sub/superscript\r\n    let labelName = '';\r\n    let subSup = '';\r\n    let isSub = false;\r\n    if (pcvData.label.includes('_') || pcvData.label.includes('^')) {\r\n      for (let i = 0; i < pcvData.label.length; i++) {\r\n        if (pcvData.label[i] === '_') {\r\n          labelName = pcvData.label.slice(0, i);\r\n          subSup = pcvData.label.slice(i + 1, pcvData.label.length);\r\n          isSub = true;\r\n        }\r\n        if (pcvData.label[i] === '^') {\r\n          labelName = pcvData.label.slice(0, i);\r\n          subSup = pcvData.label.slice(i + 1, pcvData.label.length);\r\n        }\r\n      }\r\n    } else {\r\n      labelName = pcvData.label;\r\n    }\r\n\r\n    //Computation of label offset\r\n    //Good for most of the labels\r\n    let dxOffset = Math.sign(pcvData.x) * 18,\r\n      dyOffset = -Math.sign(pcvData.y) * 18 + 7;\r\n\r\n    //Custom rules for labels\r\n    if (labelName === '♯') dyOffset -= 3;\r\n    if (labelName === 'WT' && subSup === '1') dxOffset *= 1.2;\r\n    if (labelName === 'WT' && subSup === '0') dxOffset *= 1.4;\r\n    if (labelName === 'C' && subSup === 'o7') dxOffset *= 1.2;\r\n    if (labelName === 'O' && subSup === '1,2') dyOffset *= 1.1;\r\n    if (labelName === 'C♯' && subSup === 'o7') {\r\n      dxOffset *= 1.1;\r\n      dyOffset *= 1.1;\r\n    }\r\n    if (labelName === 'D' && subSup === 'o7') {\r\n      dxOffset *= 0.7;\r\n      dyOffset *= 0.7;\r\n    }\r\n    if (labelName === 'H' && subSup === '2,3') {\r\n      dxOffset *= 1.2;\r\n      dyOffset *= 1.2;\r\n    }\r\n    if (labelName === 'H' && subSup === '1,2') {\r\n      dxOffset *= 0.7;\r\n      dyOffset *= 0.7;\r\n    }\r\n    if (labelName === 'Ω') {\r\n      dxOffset = 15;\r\n      dyOffset = 5;\r\n    }\r\n\r\n    /* if (Math.sign(pcvData.x) === 1) dxOffset = 22;\r\n    else if (Math.sign(pcvData.x) === -1) dxOffset = -20; */\r\n\r\n    /* \r\n    if (Math.sign(-pcvData.y) === 1) dyOffset = 25;\r\n    else if (Math.sign(-pcvData.y) === -1) dyOffset = -8;*/\r\n\r\n    return (\r\n      <g\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n        key={`p.${id}`}\r\n      >\r\n        <path fill={'grey'} key={id} d={mark()}></path>\r\n        <text textAnchor='middle' dx={dxOffset} dy={dyOffset} fontSize='20px'>\r\n          {labelName}\r\n          {isSub ? (\r\n            <tspan fontSize={15} baselineShift='sub'>\r\n              {subSup}\r\n            </tspan>\r\n          ) : (\r\n            <tspan fontSize={15} baselineShift='super'>\r\n              {subSup}\r\n            </tspan>\r\n          )}\r\n        </text>\r\n      </g>\r\n    );\r\n  };\r\n\r\n  const drawBorder = () => {\r\n    return (\r\n      <path\r\n        fill={'azure'}\r\n        d={d3\r\n          .arc()\r\n          .innerRadius(circleRadius - 1)\r\n          .outerRadius(circleRadius + 3)\r\n          .startAngle(0)\r\n          .endAngle(2 * Math.PI)()}\r\n      ></path>\r\n    );\r\n  };\r\n\r\n  const highlightSubdiv = (radiusScaleWidth) => {\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius(0)\r\n      .outerRadius((radiusScaleWidth * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    const highlight = d3\r\n      .arc()\r\n      .innerRadius((radiusScaleWidth * width) / 2)\r\n      .outerRadius(((radiusScaleWidth + 0.005) * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    let highlightedTrace = [];\r\n    let length = 7;\r\n    let opacityArray = [];\r\n\r\n    opacityArray.push(1);\r\n    opacityArray.push(0.5);\r\n    for (let i = 2; i < length; i++) {\r\n      opacityArray.push(\r\n        Math.round((opacityArray[i - 1] - 0.5 / (length - 2)) * 100) / 100\r\n      );\r\n    }\r\n\r\n    if (currentSubdiv < length)\r\n      highlightedTrace = traceDataCoeff.slice(0, currentSubdiv + 1);\r\n    else\r\n      highlightedTrace = traceDataCoeff.slice(\r\n        currentSubdiv - length + 1,\r\n        currentSubdiv + 1\r\n      );\r\n\r\n    highlightedTrace = highlightedTrace.reverse();\r\n\r\n    return highlightedTrace.map((coeff, i) => {\r\n      return (\r\n        <g key={`g.${i}`}>\r\n          <path\r\n            transform={`translate(${coeff.x * circleRadius},${\r\n              -coeff.y * circleRadius\r\n            })`}\r\n            fill={'white'}\r\n            key={i}\r\n            fillOpacity={opacityArray[i]}\r\n            d={mark()}\r\n          ></path>\r\n          <path\r\n            transform={`translate(${coeff.x * circleRadius},${\r\n              -coeff.y * circleRadius\r\n            })`}\r\n            fill={'black'}\r\n            fillOpacity={opacityArray[i]}\r\n            key={`t.${i}`}\r\n            d={highlight()}\r\n          ></path>\r\n        </g>\r\n      );\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ marginBottom: 2 }}>\r\n      <svg\r\n        width={targetCircleWidth}\r\n        height={targetCircleWidth}\r\n        viewBox={`0 0 ${width} ${height}`}\r\n        xmlns='http://www.w3.org/2000/svg'\r\n      >\r\n        <g transform={`translate(32,8)`}>\r\n          <circle cx='12' cy='12' r='13' fill='black' />\r\n          <text fontSize='24' textAnchor='middle' x='12' y='20' fill='white'>\r\n            {coeffNumber}\r\n          </text>\r\n        </g>\r\n        <g transform={`translate(${125},0)`}>\r\n          {showMagAndPhase ? (\r\n            <>\r\n              <text\r\n                x='120'\r\n                y='23'\r\n                style={{ fontSize: '24px' }}\r\n              >{`\\u{3C6}: ${currentSubdivCoeff.phi}\\u{b0}`}</text>\r\n              <text\r\n                x='34'\r\n                y='24'\r\n                style={{ fontSize: '24px' }}\r\n              >{`\\u{3BC}: ${currentSubdivCoeff.mu}`}</text>\r\n            </>\r\n          ) : null}\r\n        </g>\r\n\r\n        <g transform={`translate(0,${headerOffset})`}>\r\n          <foreignObject x={margin} y={margin} width={width} height={height}>\r\n            <canvas\r\n              id={`circle${coeffNumber}`}\r\n              style={{ zIndex: '-1' }}\r\n              width={width}\r\n              height={height}\r\n              ref={canvasRef}\r\n            ></canvas>\r\n          </foreignObject>\r\n          <g transform={`translate(${width / 2},${width / 2})`}>\r\n            {drawBorder()}\r\n            {protoDataCoeff\r\n              ? protoDataCoeff.map((pcv, i) => protoCircleMark(pcv, i))\r\n              : null}\r\n            {/* {traceDataCoeff\r\n          ? traceDataCoeff.map((pcv, i) =>\r\n              circleMark(pcv, marksRadiusRatio, 'black', i, 0.1)\r\n            )\r\n          : null} */}\r\n            {performanceCoeff.x === 0 && performanceCoeff.y === 0\r\n              ? null\r\n              : crossMark(performanceCoeff, marksRadiusRatio * 2, 'teal')}\r\n            {/* {userPcvsCoeff\r\n          ? userPcvsCoeff.map((pcv, i) => {\r\n              if (!pcv.isDisabled)\r\n                return circleMark(pcv, marksRadiusRatio + 0.015, '#FFF', i, 0);\r\n            })\r\n          : null} */}\r\n            {userPcvsCoeff\r\n              ? userPcvsCoeff.map((pcv, i) => {\r\n                  if (!pcv.isDisabled)\r\n                    return svgRoseIcon(\r\n                      pcv.label,\r\n                      pcv.rosePoints,\r\n                      pcv.x * circleRadius,\r\n                      -pcv.y * circleRadius,\r\n                      0.7,\r\n                      i\r\n                    );\r\n                })\r\n              : null}\r\n            {traceDataCoeff ? highlightSubdiv(marksRadiusRatio) : null}\r\n          </g>\r\n        </g>\r\n      </svg>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default Circle;\r\n","export const prototypesData = [\r\n  [\r\n    { label: 'Ω', x: 0, y: 0 },\r\n    { label: 'C', x: 1, y: 0 },\r\n    { label: 'C♯', x: 0.866, y: -0.5 },\r\n    { label: 'D', x: 0.5, y: -0.866 },\r\n    { label: 'E♭', x: 0, y: -1 },\r\n    { label: 'E', x: -0.5, y: -0.866 },\r\n    { label: 'F', x: -0.866, y: -0.5 },\r\n    { label: 'F♯', x: -1, y: 0 },\r\n    { label: 'G', x: -0.866, y: 0.5 },\r\n    { label: 'A♭', x: -0.5, y: 0.866 },\r\n    { label: 'A', x: 0, y: 1 },\r\n    { label: 'B♭', x: 0.5, y: 0.866 },\r\n    { label: 'B', x: 0.866, y: 0.5 },\r\n  ],\r\n  [\r\n    { label: 'Ω', x: 0, y: 0 },\r\n    { label: 'T_0', x: 1, y: 0 },\r\n    { label: 'T_1', x: 0.5, y: -0.866 },\r\n    { label: 'T_2', x: -0.5, y: -0.866 },\r\n    { label: 'T_3', x: -1, y: 0 },\r\n    { label: 'T_4', x: -0.5, y: 0.866 },\r\n    { label: 'T_5', x: 0.5, y: 0.866 },\r\n  ],\r\n  [\r\n    { label: 'Ω', x: 0, y: 0 },\r\n    { label: 'C+', x: 1, y: 0 },\r\n    { label: 'C♯+', x: 0, y: -1 },\r\n    { label: 'D+', x: -1, y: 0 },\r\n    { label: 'D♯+', x: 0, y: 1 },\r\n    { label: 'H_0,3', x: 0.5, y: 0.5 },\r\n    { label: 'H_0,1', x: 0.5, y: -0.5 },\r\n    { label: 'H_1,2', x: -0.5, y: -0.5 },\r\n    { label: 'H_2,3', x: -0.5, y: 0.5 },\r\n  ],\r\n  [\r\n    { label: 'Ω', x: 0, y: 0 },\r\n    { label: 'C^o7', x: 1, y: 0 },\r\n    { label: 'C♯^o7', x: -0.5, y: -0.866 },\r\n    { label: 'D^o7', x: -0.5, y: 0.866 },\r\n    { label: 'O_0,2', x: 0.25, y: 0.433 },\r\n    { label: 'O_0,1', x: 0.25, y: -0.433 },\r\n    { label: 'O_1,2', x: -0.5, y: 0 },\r\n  ],\r\n  [\r\n    { label: 'Ω', x: 0, y: 0 },\r\n    { label: 'C', x: 1, y: 0 },\r\n    { label: 'F', x: 0.866, y: -0.5 },\r\n    { label: 'B♭', x: 0.5, y: -0.866 },\r\n    { label: 'E♭', x: 0, y: -1 },\r\n    { label: 'A♭', x: -0.5, y: -0.866 },\r\n    { label: 'C♯', x: -0.866, y: -0.5 },\r\n    { label: 'F♯', x: -1, y: 0 },\r\n    { label: 'B', x: -0.866, y: 0.5 },\r\n    { label: 'E', x: -0.5, y: 0.866 },\r\n    { label: 'A', x: 0, y: 1 },\r\n    { label: 'D', x: 0.5, y: 0.866 },\r\n    { label: 'G', x: 0.866, y: 0.5 },\r\n    { label: '♮', x: 0.267, y: 0.462 },\r\n    { label: '5♭', x: 0, y: -0.533 },\r\n    { label: '2♯', x: -0.267, y: 0.462 },\r\n    { label: '3♭', x: 0.462, y: -0.267 },\r\n    { label: '4♯', x: -0.533, y: 0 },\r\n    { label: '♭', x: 0.462, y: 0.267 },\r\n    { label: '6♯', x: -0.267, y: -0.462 },\r\n    { label: '♯', x: 0, y: 0.533 },\r\n    { label: '4♭', x: 0.267, y: -0.462 },\r\n    { label: '3♯', x: -0.462, y: 0.267 },\r\n    { label: '2♭', x: 0.533, y: 0 },\r\n    { label: '5♯', x: -0.462, y: -0.267 },\r\n  ],\r\n  [\r\n    { label: 'Ω', x: 0, y: 0 },\r\n    { label: 'WT_0', x: 1, y: 0 },\r\n    { label: 'WT_1', x: -1, y: 0 },\r\n  ],\r\n];\r\n","import Circle from './Circle';\r\nimport { useEffect, useState } from 'react';\r\nimport { prototypesData } from './prototypesData';\r\n\r\nimport Box from '@mui/material/Box';\r\n\r\nfunction CoefficientsModule({\r\n  fullTraces,\r\n  coeffTracesData,\r\n  showPrototypes,\r\n  showMagAndPhase,\r\n  userPcvs,\r\n  currentSubdiv,\r\n  midiDevNotesDftCoeffs,\r\n  elemsWidth,\r\n  showFullTrace,\r\n}) {\r\n  const [selectedProtoPitchClasses, setSelectedProtoPitchClasses] =\r\n    useState(prototypesData);\r\n\r\n  const [subdivUserPcvs, setSubdivUserPcvs] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (showPrototypes) {\r\n      setSelectedProtoPitchClasses(prototypesData);\r\n    } else setSelectedProtoPitchClasses([]);\r\n  }, [showPrototypes]);\r\n\r\n  useEffect(() => {\r\n    //Subdividing the coeffs for each circle\r\n    let tempSubdivUserPcvs = [];\r\n    for (let i = 1; i < 7; i++) {\r\n      let temp = [];\r\n      for (let j = 0; j < userPcvs.length; j++) {\r\n        temp.push({\r\n          x: userPcvs[j].coeffs[i].re,\r\n          y: userPcvs[j].coeffs[i].im,\r\n          rosePoints: userPcvs[j].rosePoints,\r\n          isDisabled: userPcvs[j].isDisabled,\r\n          label: userPcvs[j].label,\r\n        });\r\n      }\r\n      tempSubdivUserPcvs.push(temp);\r\n    }\r\n\r\n    setSubdivUserPcvs(tempSubdivUserPcvs);\r\n  }, [userPcvs]);\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-around',\r\n      }}\r\n    >\r\n      {[1, 2, 3, 4, 5, 6].map((coeffNum) => (\r\n        <Circle\r\n          coeffNumber={coeffNum}\r\n          key={`w.${coeffNum}`}\r\n          protoDataCoeff={selectedProtoPitchClasses[coeffNum - 1]}\r\n          fullTrace={fullTraces[coeffNum - 1]}\r\n          traceDataCoeff={coeffTracesData[coeffNum - 1]}\r\n          userPcvsCoeff={subdivUserPcvs[coeffNum - 1]}\r\n          currentSubdiv={currentSubdiv}\r\n          performanceCoeff={midiDevNotesDftCoeffs[coeffNum]}\r\n          targetCircleWidth={elemsWidth}\r\n          showMagAndPhase={showMagAndPhase}\r\n          showFullTrace={showFullTrace}\r\n        />\r\n      ))}\r\n\r\n      {/* <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[0]}\r\n        traceDataCoeff={coeffTracesData[0]}\r\n        userPcvsCoeff={subdivUserPcvs[0]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[1]}\r\n      />\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[1]}\r\n        traceDataCoeff={coeffTracesData[1]}\r\n        userPcvsCoeff={subdivUserPcvs[1]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[2]}\r\n      />\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[2]}\r\n        traceDataCoeff={coeffTracesData[2]}\r\n        userPcvsCoeff={subdivUserPcvs[2]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[3]}\r\n      />\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[3]}\r\n        traceDataCoeff={coeffTracesData[3]}\r\n        userPcvsCoeff={subdivUserPcvs[3]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[4]}\r\n      />\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[4]}\r\n        traceDataCoeff={coeffTracesData[4]}\r\n        userPcvsCoeff={subdivUserPcvs[4]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[5]}\r\n      />\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[5]}\r\n        traceDataCoeff={coeffTracesData[5]}\r\n        userPcvsCoeff={subdivUserPcvs[5]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[6]}\r\n      /> */}\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default CoefficientsModule;\r\n","import { useState, useEffect, useRef } from 'react';\r\nimport * as Tone from 'tone';\r\nimport WavescapeModule from '../WavescapeModule';\r\nimport CoefficientsModule from '../CoefficientsModule';\r\n\r\nimport Player from '../Player';\r\n\r\nimport dft from '../DFT';\r\n\r\nimport Box from '@mui/material/Box';\r\nimport FormGroup from '@mui/material/FormGroup';\r\nimport FormControlLabel from '@mui/material/FormControlLabel';\r\nimport Switch from '@mui/material/Switch';\r\nimport InputLabel from '@mui/material/InputLabel';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport FormControl from '@mui/material/FormControl';\r\nimport Select from '@mui/material/Select';\r\nimport Slider from '@mui/material/Slider';\r\n\r\n//Drawer mui components\r\nimport { styled } from '@mui/material/styles';\r\nimport Typography from '@mui/material/Typography';\r\n\r\n//Accordion mui components\r\nimport Accordion from '@mui/material/Accordion';\r\nimport AccordionSummary from '@mui/material/AccordionSummary';\r\nimport AccordionDetails from '@mui/material/AccordionDetails';\r\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\r\n\r\n//Bottom appbar\r\nimport MuiAppBar from '@mui/material/AppBar';\r\nimport Toolbar from '@mui/material/Toolbar';\r\n\r\nconst drawerWidth = 400;\r\n\r\nconst AppBar = styled(MuiAppBar, {\r\n  shouldForwardProp: (prop) => prop !== 'open',\r\n})(({ theme, open }) => ({\r\n  transition: theme.transitions.create(['margin', 'width'], {\r\n    easing: theme.transitions.easing.sharp,\r\n    duration: theme.transitions.duration.leavingScreen,\r\n  }),\r\n  ...(open && {\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    marginLeft: `${drawerWidth}px`,\r\n    transition: theme.transitions.create(['margin', 'width'], {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  }),\r\n}));\r\n\r\nfunction Application({\r\n  fileName,\r\n  setInAnalysisPage,\r\n  open,\r\n  setOpen,\r\n  wavescapesData,\r\n  fullTraces,\r\n  coeffTracesData,\r\n  currentSubdiv,\r\n  currentWavescapeSubdiv,\r\n  userPcvs,\r\n}) {\r\n  //State: represents the selected row on the wavescape (by default the first row) for each coeff\r\n  const [showPrototypes, setShowPrototypes] = useState(true);\r\n  const [showMagAndPhase, setShowMagAndPhase] = useState(true);\r\n  const [showFullTrace, setShowFullTrace] = useState(true);\r\n\r\n  //MIDI inputs\r\n  const [midiDevNotesDftCoeffs, setMidiDevNotesDftCoeffs] = useState(\r\n    dft([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]).map((coeff) => {\r\n      return { x: coeff.re, y: coeff.im };\r\n    })\r\n  );\r\n\r\n  //Ref to get the width of the accordion used to computed layout sizes\r\n  const accordionRef = useRef(null);\r\n  const [accordionWidth, setAccordionWidth] = useState(100);\r\n  const [elemsForEachRow, setElemsForEachRow] = useState(3);\r\n  const [elemsWidth, setElemsWidth] = useState(440);\r\n\r\n  function changeElementsSize(drawerOffset = 0) {\r\n    let adjustmentFractSizes = 10;\r\n    if (accordionRef.current) {\r\n      setElemsWidth(\r\n        (accordionRef.current.clientWidth + drawerOffset) / elemsForEachRow -\r\n          adjustmentFractSizes\r\n      );\r\n    }\r\n  }\r\n\r\n  function handleResize() {\r\n    let drawerOffset = 0;\r\n    changeElementsSize(drawerOffset);\r\n  }\r\n\r\n  useEffect(() => {\r\n    setInAnalysisPage(true);\r\n\r\n    //Open drawer when page loads\r\n    setOpen(true);\r\n\r\n    //Minus some pixel for robustness: sometimes width with fractional pixels\r\n    changeElementsSize();\r\n\r\n    window.addEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    //When analysis data changes, show by default the full trace\r\n    setShowFullTrace(true);\r\n  }, [fullTraces]);\r\n\r\n  useEffect(() => {\r\n    changeElementsSize();\r\n    window.addEventListener('resize', handleResize);\r\n  }, [elemsForEachRow]);\r\n\r\n  useEffect(() => {\r\n    let drawerOffset = 0;\r\n    open ? (drawerOffset = -400) : (drawerOffset = +400);\r\n    changeElementsSize(drawerOffset);\r\n  }, [open]);\r\n\r\n  useEffect(() => {\r\n    changeElementsSize();\r\n  }, [accordionWidth]);\r\n\r\n  //MIDI devices init\r\n  useEffect(() => {\r\n    //INIT\r\n    let currentNotes = [];\r\n    const sampler = new Tone.Sampler({\r\n      urls: {\r\n        A0: 'A0.mp3',\r\n        C1: 'C1.mp3',\r\n        'D#1': 'Ds1.mp3',\r\n        'F#1': 'Fs1.mp3',\r\n        A1: 'A1.mp3',\r\n        C2: 'C2.mp3',\r\n        'D#2': 'Ds2.mp3',\r\n        'F#2': 'Fs2.mp3',\r\n        A2: 'A2.mp3',\r\n        C3: 'C3.mp3',\r\n        'D#3': 'Ds3.mp3',\r\n        'F#3': 'Fs3.mp3',\r\n        A3: 'A3.mp3',\r\n        C4: 'C4.mp3',\r\n        'D#4': 'Ds4.mp3',\r\n        'F#4': 'Fs4.mp3',\r\n        A4: 'A4.mp3',\r\n        C5: 'C5.mp3',\r\n        'D#5': 'Ds5.mp3',\r\n        'F#5': 'Fs5.mp3',\r\n        A5: 'A5.mp3',\r\n        C6: 'C6.mp3',\r\n        'D#6': 'Ds6.mp3',\r\n        'F#6': 'Fs6.mp3',\r\n        A6: 'A6.mp3',\r\n        C7: 'C7.mp3',\r\n        'D#7': 'Ds7.mp3',\r\n        'F#7': 'Fs7.mp3',\r\n        A7: 'A7.mp3',\r\n        C8: 'C8.mp3',\r\n      },\r\n      release: 1,\r\n      baseUrl: 'https://tonejs.github.io/audio/salamander/',\r\n    }).toDestination();\r\n    sampler.volume.value = -30;\r\n\r\n    if (navigator.requestMIDIAccess) {\r\n      navigator.requestMIDIAccess().then(success, failure);\r\n    }\r\n\r\n    function computeDftCoeffs(playedNotes) {\r\n      let pcv = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n\r\n      playedNotes.forEach((note) => {\r\n        let pitch;\r\n        if (note.includes('#')) {\r\n          pitch = note.slice(0, 2);\r\n        } else pitch = pitch = note.slice(0, 1);\r\n\r\n        switch (pitch) {\r\n          case 'C':\r\n            pcv[0] += 1;\r\n            break;\r\n          case 'C#':\r\n            pcv[1] += 1;\r\n            break;\r\n          case 'D':\r\n            pcv[2] += 1;\r\n            break;\r\n          case 'D#':\r\n            pcv[3] += 1;\r\n            break;\r\n          case 'E':\r\n            pcv[4] += 1;\r\n            break;\r\n          case 'F':\r\n            pcv[5] += 1;\r\n            break;\r\n          case 'F#':\r\n            pcv[6] += 1;\r\n            break;\r\n          case 'G':\r\n            pcv[7] += 1;\r\n            break;\r\n          case 'G#':\r\n            pcv[8] += 1;\r\n            break;\r\n          case 'A':\r\n            pcv[9] += 1;\r\n            break;\r\n          case 'A#':\r\n            pcv[10] += 1;\r\n            break;\r\n          case 'B':\r\n            pcv[11] += 1;\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n      });\r\n\r\n      let dftCoeffs = dft(pcv);\r\n      dftCoeffs = dftCoeffs.map((coeff) => {\r\n        return { x: coeff.re, y: coeff.im };\r\n      });\r\n      //console.log(dftCoeffs);\r\n      setMidiDevNotesDftCoeffs(dftCoeffs);\r\n    }\r\n\r\n    function handleInput(input) {\r\n      const command = input.data[0];\r\n\r\n      //Discard messages different from note on and note off\r\n      if (command !== 144 && command !== 128) return;\r\n\r\n      const note = Tone.Frequency(input.data[1], 'midi').toNote();\r\n\r\n      //Discard note off messages for unplayed notes\r\n      if (command === 128 && !currentNotes.includes(note)) return;\r\n\r\n      //Decrease velocity to avoid clipping\r\n      const velocity = Math.round(input.data[2] * 0.05);\r\n      //const velocity = input.data[2];\r\n\r\n      //console.log(`command ${command}: note ${note}, vel ${velocity}`);\r\n\r\n      switch (command) {\r\n        case 144: //noteOn\r\n          if (velocity > 0) {\r\n            //Note is on\r\n            sampler.triggerAttack(note, Tone.immediate(), velocity);\r\n            currentNotes.push(note);\r\n          } else {\r\n            //Note on + vel 0 = Note off\r\n            sampler.triggerRelease(note, Tone.immediate());\r\n            currentNotes = currentNotes.filter(\r\n              (currentNote) => currentNote !== note\r\n            );\r\n          }\r\n          break;\r\n        case 128: //noteOff\r\n          sampler.triggerRelease(note, Tone.immediate());\r\n          currentNotes = currentNotes.filter(\r\n            (currentNote) => currentNote !== note\r\n          );\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n\r\n      computeDftCoeffs(currentNotes);\r\n    }\r\n\r\n    function success(midiAccess) {\r\n      midiAccess.onstatechange = updateDevices;\r\n\r\n      const inputs = midiAccess.inputs;\r\n\r\n      inputs.forEach((input) => {\r\n        input.onmidimessage = handleInput;\r\n      });\r\n    }\r\n\r\n    function failure() {\r\n      console.log('Could not connect MIDI');\r\n    }\r\n\r\n    function updateDevices(event) {\r\n      console.log(\r\n        `Name: ${event.port.name}, Brand: ${event.port.manufacturer}, State: ${event.port.state}, Type: ${event.port.type}`\r\n      );\r\n    }\r\n  }, []);\r\n\r\n  function toggleShowPrototypes() {\r\n    setShowPrototypes(!showPrototypes);\r\n  }\r\n\r\n  function toggleShowMagAndPhase() {\r\n    setShowMagAndPhase(!showMagAndPhase);\r\n  }\r\n\r\n  function toggleShowFullTrace() {\r\n    setShowFullTrace(!showFullTrace);\r\n  }\r\n\r\n  return (\r\n    <Box>\r\n      <Box\r\n        sx={{\r\n          padding: 0,\r\n          margin: 'auto',\r\n          marginBottom: '70px',\r\n          width: `${accordionWidth}%`,\r\n        }}\r\n      >\r\n        <Accordion defaultExpanded={true}>\r\n          <AccordionSummary\r\n            expandIcon={<ExpandMoreIcon />}\r\n            aria-controls='panel1a-content'\r\n            id='panel1a-header'\r\n          >\r\n            <Typography variant='h6'>Wavescapes</Typography>\r\n          </AccordionSummary>\r\n          <AccordionDetails ref={accordionRef} sx={{ padding: 0 }}>\r\n            <WavescapeModule\r\n              wavescapesData={wavescapesData}\r\n              currentWavescapeSubdiv={currentWavescapeSubdiv}\r\n              elemsWidth={elemsWidth}\r\n            />\r\n          </AccordionDetails>\r\n        </Accordion>\r\n        <Accordion defaultExpanded={true}>\r\n          <AccordionSummary\r\n            expandIcon={<ExpandMoreIcon />}\r\n            aria-controls='panel2a-content'\r\n            id='panel2a-header'\r\n          >\r\n            <Typography variant='h6'>Fourier Coefficient Spaces</Typography>\r\n          </AccordionSummary>\r\n          <AccordionDetails sx={{ padding: 0 }}>\r\n            <CoefficientsModule\r\n              fullTraces={fullTraces}\r\n              coeffTracesData={coeffTracesData}\r\n              currentSubdiv={currentSubdiv}\r\n              showPrototypes={showPrototypes}\r\n              showMagAndPhase={showMagAndPhase}\r\n              showFullTrace={showFullTrace}\r\n              userPcvs={userPcvs}\r\n              midiDevNotesDftCoeffs={midiDevNotesDftCoeffs}\r\n              elemsWidth={elemsWidth}\r\n            />\r\n          </AccordionDetails>\r\n        </Accordion>\r\n      </Box>\r\n\r\n      <AppBar\r\n        position='fixed'\r\n        open={open}\r\n        color='secondary'\r\n        sx={{ top: 'auto', bottom: 0, maxHeight: '74px' }}\r\n      >\r\n        <Toolbar>\r\n          <Player\r\n            fileName={fileName}\r\n            currentWavescapeSubdiv={currentWavescapeSubdiv}\r\n          />\r\n          <Box\r\n            sx={{\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              margin: '2% 5%',\r\n              maxWidth: '100px',\r\n              justifyContent: 'space-evenly',\r\n            }}\r\n          >\r\n            <FormGroup>\r\n              <FormControlLabel\r\n                control={\r\n                  <Switch\r\n                    onChange={() => toggleShowFullTrace()}\r\n                    checked={showFullTrace}\r\n                    size='small'\r\n                  />\r\n                }\r\n                label={<Typography noWrap={true}>Show full trace</Typography>}\r\n              />\r\n              <FormControlLabel\r\n                control={\r\n                  <Switch\r\n                    onChange={() => toggleShowPrototypes()}\r\n                    checked={showPrototypes}\r\n                    size='small'\r\n                  />\r\n                }\r\n                label={<Typography noWrap={true}>Show Prototypes</Typography>}\r\n              />\r\n              <FormControlLabel\r\n                control={\r\n                  <Switch\r\n                    onChange={() => toggleShowMagAndPhase()}\r\n                    checked={showMagAndPhase}\r\n                    size='small'\r\n                  />\r\n                }\r\n                label={\r\n                  <Typography noWrap={true}>Show &mu; and &phi;</Typography>\r\n                }\r\n              />\r\n            </FormGroup>\r\n          </Box>\r\n          <Box sx={{ minWidth: '20%', padding: '1% 3% 1% 2%', marginTop: 1 }}>\r\n            <Typography>Plots size</Typography>\r\n            <Slider\r\n              min={20}\r\n              max={100}\r\n              value={accordionWidth}\r\n              defaultValue={100}\r\n              aria-label='Plots size'\r\n              valueLabelDisplay='auto'\r\n              onChange={(event, value) => {\r\n                setAccordionWidth(value);\r\n              }}\r\n              marks={[\r\n                { value: 20, label: '20%' },\r\n                { value: 50, label: '50%' },\r\n                { value: 100, label: '100%' },\r\n              ]}\r\n            />\r\n          </Box>\r\n          <Box sx={{ minWidth: 120 }}>\r\n            <FormControl size='small' variant='standard' fullWidth>\r\n              <InputLabel>Layout</InputLabel>\r\n              <Select\r\n                value={elemsForEachRow}\r\n                label='Layout'\r\n                onChange={(event) => {\r\n                  setAccordionWidth(100);\r\n                  setElemsForEachRow(event.target.value);\r\n                }}\r\n              >\r\n                <MenuItem value={6}>1x6</MenuItem>\r\n                <MenuItem value={3}>2x3</MenuItem>\r\n                <MenuItem value={2}>3x2</MenuItem>\r\n                <MenuItem value={1}>6x1</MenuItem>\r\n              </Select>\r\n            </FormControl>\r\n          </Box>\r\n        </Toolbar>\r\n      </AppBar>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default Application;\r\n","import * as d3 from 'd3';\r\nimport * as math from 'mathjs';\r\nimport { gradient } from './colorMapping';\r\n//import { useEffect, useRef } from 'react';\r\n\r\n//Minus before every y coordinate due to the fact that svg has positive y\r\n//downward, meanwhile cartesian plane has positive y upward\r\n\r\nexport default ({\r\n  traceData,\r\n  userPcv,\r\n  prototypesData,\r\n  coeffNumber,\r\n  showNumber,\r\n}) => {\r\n  //Size and N number of subdivisions of the arches\r\n  const width = 450;\r\n  const height = width;\r\n  const innerWidth = 0.8 * width;\r\n  //const innerHeight = innerWidth;\r\n  const N = 50;\r\n  const K = 20;\r\n\r\n  let marksRadiusRatio = 0.01;\r\n  let circleRadius = innerWidth / 2;\r\n\r\n  //console.log(traceData);\r\n\r\n  /* const canvasRef = useRef(null);\r\n\r\n   useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n    //ctx.setTransform(1, 0, 0, -1, 0, ctx.canvas.height);\r\n\r\n    let margins = [100, 100];\r\n    let innerSize = [canvas.width - margins[0], canvas.height - margins[1]];\r\n  }, []); */\r\n\r\n  /* const outerRadius = (0.9 * height) / 2;\r\n  const innerRadius = (0.7 * height) / 2; */\r\n\r\n  const theta = (2 * math.pi) / N;\r\n  const angles = d3.range(0, 2 * math.pi, theta);\r\n  const circularSectors = d3.range(0, 1, 1 / K);\r\n\r\n  //Generates all the arches that compose the circle\r\n  const arc = (angle, id, index, inner) => {\r\n    const offset = -math.pi / 2;\r\n\r\n    const d = d3\r\n      .arc()\r\n      .innerRadius((inner * innerWidth) / 2)\r\n      .outerRadius(((inner + 1 / K) * innerWidth) / 2)\r\n      .startAngle(-(angle + offset))\r\n      .endAngle(-(angle + theta + offset));\r\n\r\n    return (\r\n      <path\r\n        key={`${index}.${id}`}\r\n        fill={gradient(angle)}\r\n        fillOpacity={inner}\r\n        stroke={gradient(angle)}\r\n        strokeOpacity={inner / 10}\r\n        d={d()}\r\n        /* shapeRendering={'geometricPrecision'} */\r\n      ></path>\r\n    );\r\n  };\r\n\r\n  const circleMark = (pcvData, radiusScaleWidth, color, id, opacity = 1) => {\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius(0)\r\n      .outerRadius((radiusScaleWidth * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    return (\r\n      <path\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n        fill={color}\r\n        fillOpacity={opacity}\r\n        key={id}\r\n        d={mark()}\r\n      ></path>\r\n    );\r\n  };\r\n\r\n  const protoCircleMark = (pcvData, id) => {\r\n    let scaleRatio = 0.02;\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius((scaleRatio * width) / 2)\r\n      .outerRadius(((scaleRatio + 0.01) * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    //Check for sub/superscript\r\n    let labelName = '';\r\n    let subSup = '';\r\n    let isSub = false;\r\n    if (pcvData.label.includes('_') || pcvData.label.includes('^')) {\r\n      for (let i = 0; i < pcvData.label.length; i++) {\r\n        if (pcvData.label[i] === '_') {\r\n          labelName = pcvData.label.slice(0, i);\r\n          subSup = pcvData.label.slice(i + 1, pcvData.label.length);\r\n          isSub = true;\r\n        }\r\n        if (pcvData.label[i] === '^') {\r\n          labelName = pcvData.label.slice(0, i);\r\n          subSup = pcvData.label.slice(i + 1, pcvData.label.length);\r\n        }\r\n      }\r\n    } else {\r\n      labelName = pcvData.label;\r\n    }\r\n\r\n    //Computation of label offset\r\n    //Good for most of the labels\r\n    let dxOffset = Math.sign(pcvData.x) * 18,\r\n      dyOffset = -Math.sign(pcvData.y) * 18 + 7;\r\n\r\n    //Custom rules for labels\r\n    if (labelName === '♯') dyOffset -= 3;\r\n    if (labelName === 'WT' && subSup === '1') dxOffset *= 1.2;\r\n    if (labelName === 'WT' && subSup === '0') dxOffset *= 1.4;\r\n    if (labelName === 'C' && subSup === 'o7') dxOffset *= 1.2;\r\n    if (labelName === 'O' && subSup === '1,2') dyOffset *= 1.1;\r\n    if (labelName === 'C♯' && subSup === 'o7') {\r\n      dxOffset *= 1.1;\r\n      dyOffset *= 1.1;\r\n    }\r\n    if (labelName === 'D' && subSup === 'o7') {\r\n      dxOffset *= 0.7;\r\n      dyOffset *= 0.7;\r\n    }\r\n    if (labelName === 'H' && subSup === '2,3') {\r\n      dxOffset *= 1.2;\r\n      dyOffset *= 1.2;\r\n    }\r\n    if (labelName === 'H' && subSup === '1,2') {\r\n      dxOffset *= 0.7;\r\n      dyOffset *= 0.7;\r\n    }\r\n    if (labelName === 'Ω') {\r\n      dxOffset = 15;\r\n      dyOffset = 5;\r\n    }\r\n\r\n    /* if (Math.sign(pcvData.x) === 1) dxOffset = 22;\r\n    else if (Math.sign(pcvData.x) === -1) dxOffset = -20; */\r\n\r\n    /* \r\n    if (Math.sign(-pcvData.y) === 1) dyOffset = 25;\r\n    else if (Math.sign(-pcvData.y) === -1) dyOffset = -8;*/\r\n\r\n    return (\r\n      <g\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n        key={`p.${id}`}\r\n      >\r\n        <path fill={'grey'} key={id} d={mark()}></path>\r\n        <text textAnchor='middle' dx={dxOffset} dy={dyOffset} fontSize='20px'>\r\n          {labelName}\r\n          {isSub ? (\r\n            <tspan fontSize={15} baselineShift='sub'>\r\n              {subSup}\r\n            </tspan>\r\n          ) : (\r\n            <tspan fontSize={15} baselineShift='super'>\r\n              {subSup}\r\n            </tspan>\r\n          )}\r\n        </text>\r\n      </g>\r\n    );\r\n  };\r\n\r\n  function svgRoseIcon(rosePoints, translateX, translateY, scale, i) {\r\n    return (\r\n      <g key={`rose${i}`}>\r\n        <polyline\r\n          transform={`translate(${translateX},${translateY}) scale(${scale})`}\r\n          fill='none'\r\n          stroke='black'\r\n          strokeWidth='1px'\r\n          points={rosePoints}\r\n        />\r\n      </g>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <svg\r\n      xmlns='http://www.w3.org/2000/svg'\r\n      key={`circle${coeffNumber}`}\r\n      width={width}\r\n      height={height}\r\n    >\r\n      {showNumber ? (\r\n        <g transform={`translate(32,20)`}>\r\n          <circle cx='12' cy='12' r='13' fill='black' />\r\n          <text fontSize='24' textAnchor='middle' x='12' y='20' fill='white'>\r\n            {coeffNumber}\r\n          </text>\r\n        </g>\r\n      ) : null}\r\n\r\n      <g transform={`translate(${width / 2},${height / 2})`}>\r\n        {circularSectors.map((innerRadius) =>\r\n          angles.map((angle, id) => arc(angle, id, coeffNumber, innerRadius))\r\n        )}\r\n        {traceData.map((pcv, i) =>\r\n          circleMark(pcv, marksRadiusRatio, 'black', i, 0.2)\r\n        )}\r\n        {userPcv\r\n          ? userPcv.map((pcv, i) => {\r\n              if (!pcv.isDisabled)\r\n                return svgRoseIcon(\r\n                  pcv.rosePoints,\r\n                  pcv.x * circleRadius,\r\n                  -pcv.y * circleRadius,\r\n                  0.7,\r\n                  i\r\n                );\r\n            })\r\n          : null}\r\n        {prototypesData.map((pcv, i) => protoCircleMark(pcv, i))}\r\n      </g>\r\n    </svg>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nconst verticalScale = Math.sin(Math.PI / 3);\r\n\r\nfunction WavescapeSVG({ wsNumber, wavescapeMatrix, showNumber }) {\r\n  const margin = 10;\r\n  const width = 400;\r\n  const height = width;\r\n  /* const [wsCoordinates, setWsCoordinates] = useState([]); */\r\n\r\n  let margins = [margin, margin];\r\n  let innerSize = [width - margins[0], width - margins[1]];\r\n  let baseSubdivision;\r\n  let wsCoordinates;\r\n\r\n  baseSubdivision = wavescapeMatrix[0].length;\r\n  wsCoordinates = computeTicks(\r\n    innerSize[0],\r\n    innerSize[1],\r\n    baseSubdivision,\r\n    margins[0],\r\n    margins[1]\r\n  );\r\n\r\n  return (\r\n    <svg\r\n      id={`wavescape${wsNumber}`}\r\n      width={width + margin}\r\n      height={height}\r\n      xmlns='http://www.w3.org/2000/svg'\r\n    >\r\n      {showNumber ? (\r\n        <g transform={`translate(32,20)`}>\r\n          <circle cx='12' cy='12' r='13' fill='black' />\r\n          <text fontSize='24' textAnchor='middle' x='12' y='20' fill='white'>\r\n            {wsNumber}\r\n          </text>\r\n        </g>\r\n      ) : null}\r\n\r\n      <g\r\n        transform={`scale(${1}, ${-verticalScale}) translate(${0},${\r\n          -height - 2 * margin\r\n        })`}\r\n      >\r\n        {/* Contour line */}\r\n        {wsCoordinates.length > 0 ? (\r\n          <>\r\n            <line\r\n              x1={wsCoordinates[0][0].x}\r\n              x2={wsCoordinates[0][wsCoordinates[0].length - 1].x}\r\n              y1={wsCoordinates[0][0].y}\r\n              y2={wsCoordinates[0][wsCoordinates[0].length - 1].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n            <line\r\n              x1={wsCoordinates[0][wsCoordinates[0].length - 1].x}\r\n              x2={wsCoordinates[wsCoordinates.length - 1][0].x}\r\n              y1={wsCoordinates[0][wsCoordinates[0].length - 1].y}\r\n              y2={wsCoordinates[wsCoordinates.length - 1][0].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n            <line\r\n              x1={wsCoordinates[0][0].x}\r\n              x2={wsCoordinates[wsCoordinates.length - 1][0].x}\r\n              y1={wsCoordinates[0][0].y}\r\n              y2={wsCoordinates[wsCoordinates.length - 1][0].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n          </>\r\n        ) : null}\r\n        {wavescapeMatrix.map((row, i) => {\r\n          return row.map((elem, j) => {\r\n            if (i === 0) {\r\n              return (\r\n                <polygon\r\n                  points={`${wsCoordinates[i][j].x},${wsCoordinates[i][j].y}\r\n                 ${wsCoordinates[i][j + 1].x},${wsCoordinates[i][j + 1].y} \r\n                 ${wsCoordinates[i + 1][j].x},${wsCoordinates[i + 1][j].y}`}\r\n                  fill={elem}\r\n                />\r\n              );\r\n            } else {\r\n              return (\r\n                <polygon\r\n                  points={`\r\n                 ${wsCoordinates[i][j].x},${wsCoordinates[i][j].y}\r\n                 ${wsCoordinates[i - 1][j + 1].x},${\r\n                    wsCoordinates[i - 1][j + 1].y\r\n                  }\r\n                 ${wsCoordinates[i][j + 1].x},${wsCoordinates[i][j + 1].y} \r\n                 ${wsCoordinates[i + 1][j].x},${wsCoordinates[i + 1][j].y}\r\n                 `}\r\n                  fill={elem}\r\n                />\r\n              );\r\n            }\r\n          });\r\n        })}\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default WavescapeSVG;\r\n\r\nfunction computeTicks(\r\n  innerWidth,\r\n  innerHeight,\r\n  baseSubdivision,\r\n  marginLeft,\r\n  marginTop\r\n) {\r\n  //Actually, it is a square matrix\r\n  let unit = innerWidth / baseSubdivision;\r\n  let mat = [];\r\n\r\n  for (let i = 0; i < baseSubdivision + 1; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < baseSubdivision + 1; j++) {\r\n      if (i <= j)\r\n        temp.push({\r\n          x: (j - i) * unit + (i * unit) / 2 + marginLeft,\r\n          y: i * unit + marginTop,\r\n        });\r\n    }\r\n    mat.push(temp);\r\n  }\r\n\r\n  return mat;\r\n}\r\n\r\nfunction drawWavescape(ticks, ctx, wavescapeMatrix) {\r\n  for (let i = 0; i < ticks.length - 1; i++) {\r\n    for (let j = 0; j < ticks[i].length - 1; j++) {\r\n      if (i === 0) {\r\n        //first row composed by triangles\r\n        ctx.beginPath();\r\n        ctx.moveTo(ticks[i][j].x, ticks[i][j].y);\r\n        ctx.lineTo(ticks[i][j + 1].x, ticks[i][j + 1].y);\r\n        ctx.lineTo(ticks[i + 1][j].x, ticks[i + 1][j].y);\r\n        ctx.fillStyle = wavescapeMatrix[i][j];\r\n        ctx.fill();\r\n      } else {\r\n        //other rows composed by diamonds\r\n        ctx.beginPath();\r\n        ctx.moveTo(ticks[i][j].x, ticks[i][j].y);\r\n        ctx.lineTo(ticks[i - 1][j + 1].x, ticks[i - 1][j + 1].y);\r\n        ctx.lineTo(ticks[i][j + 1].x, ticks[i][j + 1].y);\r\n        ctx.lineTo(ticks[i + 1][j].x, ticks[i + 1][j].y);\r\n        ctx.fillStyle = wavescapeMatrix[i][j];\r\n        ctx.fill();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { useEffect, useState } from 'react';\r\n\r\nimport JSZip from 'jszip';\r\nimport { saveAs } from 'file-saver';\r\nimport CircleSVG from './CircleSVG';\r\nimport WavescapeSVG from './WavescapeSVG';\r\nimport ReactDOMServer from 'react-dom/server';\r\n\r\nimport { prototypesData } from './prototypesData';\r\n\r\nimport Button from '@mui/material/Button';\r\nimport Dialog from '@mui/material/Dialog';\r\nimport DialogActions from '@mui/material/DialogActions';\r\nimport DialogContent from '@mui/material/DialogContent';\r\nimport DialogContentText from '@mui/material/DialogContentText';\r\nimport DialogTitle from '@mui/material/DialogTitle';\r\nimport FormGroup from '@mui/material/FormGroup';\r\nimport FormControlLabel from '@mui/material/FormControlLabel';\r\nimport Checkbox from '@mui/material/Checkbox';\r\nimport Typography from '@mui/material/Typography';\r\nimport Box from '@mui/system/Box';\r\nimport Popover from '@mui/material/Popover';\r\n\r\nfunction SaveDialog({ traces, userPcvs, wavescapesData }) {\r\n  const [open, setOpen] = useState(false);\r\n  const [subdivUserPcvs, setSubdivUserPcvs] = useState([]);\r\n  const [canSave, setCanSave] = useState(false);\r\n\r\n  const [checkNumb, setCheckNumb] = useState(true);\r\n  const [checkTrace, setCheckTrace] = useState(true);\r\n  const [checkProto, setCheckProto] = useState(true);\r\n  const [checkPcvs, setCheckPcvs] = useState(true);\r\n\r\n  const [anchorEl, setAnchorEl] = useState(null);\r\n\r\n  const handleClickPopover = (event) => {\r\n    if (canSave) saveImages();\r\n    else setAnchorEl(event.currentTarget);\r\n  };\r\n\r\n  const handleClosePopover = () => {\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const openPopover = Boolean(anchorEl);\r\n  const id = open ? 'simple-popover' : undefined;\r\n\r\n  const handleClickOpen = () => {\r\n    setOpen(true);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    wavescapesData.length > 0 ? setCanSave(true) : setCanSave(false);\r\n  }, [wavescapesData]);\r\n\r\n  useEffect(() => {\r\n    //Subdividing the coeffs for each circle\r\n    let tempSubdivUserPcvs = [];\r\n    for (let i = 1; i < 7; i++) {\r\n      let temp = [];\r\n      for (let j = 0; j < userPcvs.length; j++) {\r\n        temp.push({\r\n          x: userPcvs[j].coeffs[i].re,\r\n          y: userPcvs[j].coeffs[i].im,\r\n          rosePoints: userPcvs[j].rosePoints,\r\n          isDisabled: userPcvs[j].isDisabled,\r\n          label: userPcvs[j].label,\r\n        });\r\n      }\r\n      tempSubdivUserPcvs.push(temp);\r\n    }\r\n\r\n    setSubdivUserPcvs(tempSubdivUserPcvs);\r\n  }, [userPcvs]);\r\n\r\n  function generateWavescapeSVG(k) {\r\n    let data = (\r\n      <WavescapeSVG\r\n        wavescapeMatrix={wavescapesData.length > 0 ? wavescapesData[k - 1] : []}\r\n        wsNumber={k}\r\n        showNumber={checkNumb}\r\n      />\r\n    );\r\n\r\n    return ReactDOMServer.renderToStaticMarkup(data);\r\n  }\r\n\r\n  function generateCircleSVG(k) {\r\n    let data = (\r\n      <CircleSVG\r\n        traceData={traces.length > 0 && checkTrace ? traces[k - 1] : []}\r\n        prototypesData={checkProto ? prototypesData[k - 1] : []}\r\n        userPcv={checkPcvs ? subdivUserPcvs[k - 1] : []}\r\n        coeffNumber={k}\r\n        showNumber={checkNumb}\r\n      />\r\n    );\r\n\r\n    return ReactDOMServer.renderToStaticMarkup(data);\r\n  }\r\n\r\n  const saveImages = () => {\r\n    let zip = new JSZip();\r\n\r\n    [1, 2, 3, 4, 5, 6].forEach((i) => {\r\n      //Generate SVGs\r\n      let circleSVG = generateCircleSVG(i);\r\n      let wavescapeSVG = generateWavescapeSVG(i);\r\n\r\n      //Adding files to zip\r\n      zip.file(`wavescapes/wavescape${i}.svg`, wavescapeSVG);\r\n      zip.file(`fourier/space${i}.svg`, circleSVG);\r\n    });\r\n\r\n    //Generate zip and save it\r\n    zip.generateAsync({ type: 'blob' }).then(function (content) {\r\n      saveAs(content, 'images.zip');\r\n    });\r\n\r\n    setOpen(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        variant='contained'\r\n        size='small'\r\n        color='primary'\r\n        sx={{\r\n          width: '35%',\r\n          margin: 'auto',\r\n          marginTop: 1,\r\n          marginBottom: 1,\r\n        }}\r\n        onClick={handleClickOpen}\r\n      >\r\n        Export images\r\n      </Button>\r\n      <Dialog open={open} onClose={handleClose}>\r\n        <DialogTitle>{'Saving options'}</DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText>\r\n            <Typography sx={{ color: 'black' }}>\r\n              Check the box in order to include the correspondent element in the\r\n              exported images:\r\n            </Typography>\r\n\r\n            <Box sx={{ marginLeft: 2, marginTop: 1 }}>\r\n              <FormGroup sx={{ color: 'black' }}>\r\n                <FormControlLabel\r\n                  control={\r\n                    <Checkbox\r\n                      size='small'\r\n                      checked={checkNumb}\r\n                      onChange={() => {\r\n                        setCheckNumb(!checkNumb);\r\n                      }}\r\n                    />\r\n                  }\r\n                  label='Coefficients numbers'\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Checkbox\r\n                      size='small'\r\n                      checked={checkTrace}\r\n                      onChange={() => {\r\n                        setCheckTrace(!checkTrace);\r\n                      }}\r\n                    />\r\n                  }\r\n                  label='Full trace'\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Checkbox\r\n                      size='small'\r\n                      checked={checkProto}\r\n                      onChange={() => {\r\n                        setCheckProto(!checkProto);\r\n                      }}\r\n                    />\r\n                  }\r\n                  label='Prototypes'\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Checkbox\r\n                      size='small'\r\n                      checked={checkPcvs}\r\n                      onChange={() => {\r\n                        setCheckPcvs(!checkPcvs);\r\n                      }}\r\n                    />\r\n                  }\r\n                  label='Custom pitch-class vectors'\r\n                />\r\n              </FormGroup>\r\n            </Box>\r\n          </DialogContentText>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleClose}>Close</Button>\r\n          <Button onClick={handleClickPopover} autoFocus>\r\n            Save\r\n          </Button>\r\n          <Popover\r\n            id={id}\r\n            open={openPopover}\r\n            anchorEl={anchorEl}\r\n            onClose={handleClosePopover}\r\n            anchorOrigin={{\r\n              vertical: 'center',\r\n              horizontal: 'left',\r\n            }}\r\n          >\r\n            <Typography color='error' sx={{ p: 2 }}>\r\n              Upload a MIDI file\r\n            </Typography>\r\n          </Popover>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default SaveDialog;\r\n","import Navbar from './Navbar';\r\nimport { HashRouter, Route, Switch } from 'react-router-dom';\r\nimport CssBaseline from '@mui/material/CssBaseline';\r\nimport { useState, useEffect, useRef } from 'react';\r\n\r\nimport { setPlayerMidiData } from './Player';\r\nimport {\r\n  getComplementaryColours,\r\n  getRgbaMatrix,\r\n  getMidiFileDataObject,\r\n  getDftCoeffStatic,\r\n  getDftCoeffDynamic,\r\n} from './getDftMatrices';\r\nimport dft from './DFT';\r\nimport parse from './parser';\r\nimport { getRosePoints } from './roses';\r\n\r\nimport ResolutionSelector from './ResolutionSelector';\r\nimport PcvChipsBox from './PcvChipsBox';\r\n\r\n//Pages\r\nimport Home from './pages/Home';\r\nimport Theory from './pages/Theory';\r\nimport Analysis from './pages/Analysis';\r\n\r\n//Test\r\nimport { styled, useTheme } from '@mui/material/styles';\r\nimport Box from '@mui/material/Box';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport ChevronLeftIcon from '@mui/icons-material/ChevronLeft';\r\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\r\nimport TextField from '@mui/material/TextField';\r\nimport Stack from '@mui/material/Stack';\r\nimport Paper from '@mui/material/Paper';\r\nimport Slider from '@mui/material/Slider';\r\n\r\nimport Typography from '@mui/material/Typography';\r\nimport Button from '@mui/material/Button';\r\nimport Divider from '@mui/material/Divider';\r\nimport FormControlLabel from '@mui/material/FormControlLabel';\r\nimport MuiSwitch from '@mui/material/Switch';\r\nimport SaveDialog from './SaveDialog';\r\n\r\nconst drawerWidth = 400;\r\n\r\n//Song variables\r\nlet currentSongBPM = 80;\r\nlet currentSongMidiData;\r\nlet fileName;\r\n\r\nconst Main = styled('main', { shouldForwardProp: (prop) => prop !== 'open' })(\r\n  ({ theme, open }) => ({\r\n    flexGrow: 1,\r\n    padding: theme.spacing(3),\r\n    backgroundColor: '#e0e0e0',\r\n    transition: theme.transitions.create('margin', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n    marginLeft: `-${drawerWidth}px`,\r\n    ...(open && {\r\n      transition: theme.transitions.create('margin', {\r\n        easing: theme.transitions.easing.easeOut,\r\n        duration: theme.transitions.duration.enteringScreen,\r\n      }),\r\n      marginLeft: 0,\r\n      backgroundColor: '#e0e0e0',\r\n    }),\r\n  })\r\n);\r\n\r\nconst DrawerHeader = styled('div')(({ theme }) => ({\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  padding: theme.spacing(0, 1),\r\n  // necessary for content to be below app bar\r\n  ...theme.mixins.toolbar,\r\n  justifyContent: 'space-between',\r\n}));\r\n\r\nfunction App() {\r\n  const theme = useTheme();\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const [file, setFile] = useState('');\r\n  //State: contains the color data of the wavescape of a given coeff (Array(6) one for coeff)\r\n  const [wavescapesData, setWavescapesData] = useState([]);\r\n\r\n  //State: represents the selected row on the wavescape (by default the first row) for each coeff\r\n  const [coeffTracesData, setCoeffTracesData] = useState([]);\r\n  const [windowedCoeffTraces, setWindowedCoeffTraces] = useState([]);\r\n  const [currentSubdiv, setCurrentSubdiv] = useState(0);\r\n  const [windowLen, setWindowLen] = useState(1);\r\n  const [invalidWndLen, setInvalidWndLen] = useState(false);\r\n  const [textfieldWndLen, setTextfieldWndLen] = useState('1');\r\n\r\n  //State: inputs\r\n  const [resolutionMode, setResolutionMode] = useState({\r\n    noteResolutionValue: 1,\r\n    seconds: 1.5,\r\n    useSeconds: false,\r\n  });\r\n  const [wavescapeResolution, setWavescapeResolution] = useState(10);\r\n  const [circleResolution, setCircleResolution] = useState(1);\r\n\r\n  const [userPcvs, setUserPcvs] = useState([]);\r\n  const pcvTextRef = useRef(null);\r\n\r\n  //State: error states in input\r\n  const [isInputPcvInvalid, setIsInputPcvInvalid] = useState(false);\r\n\r\n  //State: in analysis page flag\r\n  const [inAnalysisPage, setInAnalysisPage] = useState(false);\r\n\r\n  //State: usable/used roses for pcvs' labels\r\n  const [rosesMat, setRosesMat] = useState([]);\r\n\r\n  //When window length is changed, recompute the trace to be visualized\r\n  useEffect(() => {\r\n    let temp = [];\r\n\r\n    if (windowLen === 1) setWindowedCoeffTraces(coeffTracesData);\r\n    else {\r\n      coeffTracesData.forEach((trace) => {\r\n        let windowedTrace = [];\r\n\r\n        for (let i = 0; i <= trace.length - windowLen; i++) {\r\n          let smoothedPoint = { x: 0, y: 0 };\r\n          for (let j = 0; j < windowLen; j++) {\r\n            smoothedPoint.x += trace[i + j].x;\r\n            smoothedPoint.y += trace[i + j].y;\r\n          }\r\n          windowedTrace.push(smoothedPoint);\r\n        }\r\n\r\n        //Normalization\r\n        windowedTrace.forEach((smoothedPoint) => {\r\n          smoothedPoint.x = smoothedPoint.x / windowLen;\r\n          smoothedPoint.y = smoothedPoint.y / windowLen;\r\n        });\r\n\r\n        temp.push(windowedTrace);\r\n      });\r\n\r\n      setWindowedCoeffTraces(temp);\r\n    }\r\n  }, [windowLen, coeffTracesData]);\r\n\r\n  function handleSubmitPitchClass(input) {\r\n    //In order not to refresh the page (default behaviuor)\r\n    let parsedInput;\r\n    let userPcvObjects = [];\r\n\r\n    try {\r\n      parsedInput = parse(input);\r\n    } catch (error) {\r\n      console.log(error.message);\r\n      setIsInputPcvInvalid(true);\r\n      return;\r\n    }\r\n\r\n    parsedInput.forEach((input) =>\r\n      userPcvObjects.push({\r\n        label: `(${input})`,\r\n        isDisabled: false,\r\n        coeffs: dft(input, true, true, false),\r\n        rosePoints: [],\r\n        n: -1,\r\n        d: -1,\r\n      })\r\n    );\r\n\r\n    //Check if we are adding an input already inserted\r\n    let labels = userPcvs.map((pcvData) => pcvData.label);\r\n    labels.forEach((label) => {\r\n      userPcvObjects = userPcvObjects.filter(\r\n        (pcvObj) => pcvObj.label !== label\r\n      );\r\n    });\r\n\r\n    //Assing an unused rose to each pcv\r\n    userPcvObjects.forEach((pcvData) => {\r\n      let found = false;\r\n\r\n      for (let i = 0; i < rosesMat.length && !found; i++) {\r\n        for (let j = 0; j < rosesMat[i].length && !found; j++) {\r\n          if (rosesMat[i][j].usable && !rosesMat[i][j].used) {\r\n            found = true;\r\n            pcvData.rosePoints = rosesMat[i][j].points;\r\n            rosesMat[i][j].used = true;\r\n            pcvData.n = rosesMat[i][j].n;\r\n            pcvData.d = rosesMat[i][j].d;\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    setUserPcvs([...userPcvs, ...userPcvObjects]);\r\n  }\r\n\r\n  //MIDI parsing on file change\r\n  useEffect(() => {\r\n    let input = document.getElementById('file').files[0];\r\n\r\n    if (input) {\r\n      let fileReader = new FileReader();\r\n      fileReader.readAsArrayBuffer(input);\r\n      fileReader.onload = (loadedFile) => {\r\n        try {\r\n          let { midiData, midiBpm } = getMidiFileDataObject(\r\n            loadedFile.target.result\r\n          );\r\n\r\n          currentSongBPM = midiBpm;\r\n          currentSongMidiData = midiData;\r\n          fileName = input.name;\r\n\r\n          //Wavescapes static analysis\r\n          let subdivsNumberStatic = 50;\r\n          let staticResolution =\r\n            currentSongMidiData.duration / subdivsNumberStatic;\r\n          setWavescapeResolution(staticResolution);\r\n\r\n          setWavescapesData(\r\n            getRgbaMatrix(\r\n              getDftCoeffStatic(currentSongMidiData, staticResolution)\r\n            )\r\n          );\r\n\r\n          //Circles dynamic analysis\r\n          let { tracesData, resolution } = getDftCoeffDynamic(\r\n            midiData,\r\n            resolutionMode,\r\n            currentSongBPM\r\n          );\r\n          setCircleResolution(resolution);\r\n          setCoeffTracesData(tracesData);\r\n          setPlayerMidiData(currentSongMidiData, resolution, setCurrentSubdiv);\r\n          setWindowLen(1);\r\n          setTextfieldWndLen('1');\r\n\r\n          console.log(midiData);\r\n        } catch (error) {\r\n          console.log(error);\r\n          return;\r\n        }\r\n      };\r\n    }\r\n  }, [file]);\r\n\r\n  //Init roseMatrix and user pcv examples\r\n  useEffect(() => {\r\n    let initMatrix = [];\r\n    for (let i = 1; i <= 7; i++) {\r\n      let temp = [];\r\n      for (let j = 1; j <= 7; j++) {\r\n        let rose = { n: j, d: i, used: false, usable: true, points: [] };\r\n        if (j % i === 0 && i !== 1) rose.usable = false;\r\n\r\n        if (rose.usable === true) rose.points = getRosePoints(j, i);\r\n\r\n        temp.push(rose);\r\n      }\r\n      initMatrix.push(temp);\r\n    }\r\n\r\n    //(0,0) or n=1, d=1 can't be used since it is a simple circle\r\n    initMatrix[0][0].usable = false;\r\n\r\n    setRosesMat(initMatrix);\r\n\r\n    let examplePcvs = [\r\n      [1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0], // C\r\n      [1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0], // Cmin\r\n      [1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0], // Cdim\r\n    ];\r\n\r\n    let exPcvObjects = examplePcvs.map((pcv) => {\r\n      return {\r\n        label: `(${pcv.toString()})`,\r\n        isDisabled: false,\r\n        coeffs: dft(pcv, true, true, false),\r\n        rosePoints: [],\r\n        n: -1,\r\n        d: -1,\r\n      };\r\n    });\r\n\r\n    //Assing an unused rose to each pcv\r\n    exPcvObjects.forEach((pcvData) => {\r\n      let found = false;\r\n\r\n      for (let i = 0; i < initMatrix.length && !found; i++) {\r\n        for (let j = 0; j < initMatrix[i].length && !found; j++) {\r\n          if (initMatrix[i][j].usable && !initMatrix[i][j].used) {\r\n            found = true;\r\n            pcvData.rosePoints = initMatrix[i][j].points;\r\n            initMatrix[i][j].used = true;\r\n            pcvData.n = initMatrix[i][j].n;\r\n            pcvData.d = initMatrix[i][j].d;\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    exPcvObjects[1].isDisabled = true;\r\n    exPcvObjects[2].isDisabled = true;\r\n\r\n    setUserPcvs(exPcvObjects);\r\n  }, []);\r\n\r\n  const handleDrawerClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  function retriggerAnalysis() {\r\n    //Only if there is midi data, retrigger analysis\r\n    if (currentSongMidiData == null) {\r\n      return;\r\n    }\r\n\r\n    //Circles dynamic analysis\r\n    let { tracesData, resolution } = getDftCoeffDynamic(\r\n      currentSongMidiData,\r\n      resolutionMode,\r\n      currentSongBPM\r\n    );\r\n    setCircleResolution(resolution);\r\n    setCoeffTracesData(tracesData);\r\n    setWindowLen(1);\r\n    setTextfieldWndLen('1');\r\n    setPlayerMidiData(currentSongMidiData, resolution, setCurrentSubdiv);\r\n  }\r\n\r\n  return (\r\n    <HashRouter>\r\n      <CssBaseline />\r\n      <Navbar\r\n        open={open}\r\n        setOpen={setOpen}\r\n        setInAnalysisPage={setInAnalysisPage}\r\n        inAnalysisPage={inAnalysisPage}\r\n      />\r\n      <Box sx={{ display: 'flex' }}>\r\n        <Drawer\r\n          sx={{\r\n            width: drawerWidth,\r\n            flexShrink: 0,\r\n            '& .MuiDrawer-paper': {\r\n              width: drawerWidth,\r\n              boxSizing: 'border-box',\r\n            },\r\n          }}\r\n          variant='persistent'\r\n          anchor='left'\r\n          open={open}\r\n        >\r\n          <DrawerHeader>\r\n            <Stack sx={{ flexGrow: '2', maxWidth: '85%', marginBottom: 1 }}>\r\n              <Typography sx={{ fontWeight: 'bold' }}>\r\n                Upload a midi file\r\n              </Typography>\r\n              <Stack spacing={2} direction='row' sx={{ alignItems: 'center' }}>\r\n                <label htmlFor='file'>\r\n                  <input\r\n                    style={{ display: 'none' }}\r\n                    type='file'\r\n                    id='file'\r\n                    name='file'\r\n                    value={file}\r\n                    onChange={(e) => setFile(e.target.value)}\r\n                  />\r\n                  <Button\r\n                    variant='contained'\r\n                    size='small'\r\n                    color='primary'\r\n                    component='span'\r\n                  >\r\n                    Upload\r\n                  </Button>\r\n                </label>\r\n                <Typography\r\n                  noWrap={true}\r\n                  color={fileName ? 'primary' : 'error'}\r\n                >\r\n                  {wavescapesData.length > 0\r\n                    ? fileName\r\n                    : 'No midi file uploaded'}\r\n                </Typography>\r\n              </Stack>\r\n            </Stack>\r\n\r\n            <IconButton onClick={handleDrawerClose}>\r\n              {theme.direction === 'ltr' ? (\r\n                <ChevronLeftIcon />\r\n              ) : (\r\n                <ChevronRightIcon />\r\n              )}\r\n            </IconButton>\r\n          </DrawerHeader>\r\n          <Divider />\r\n          <Typography sx={{ marginLeft: 1, marginTop: 1, fontWeight: 'bold' }}>\r\n            Time resolution\r\n          </Typography>\r\n          <Box\r\n            sx={{\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              margin: '2% 5% 0 2%',\r\n              width: '90%',\r\n              justifyContent: 'space-evenly',\r\n            }}\r\n          >\r\n            <ResolutionSelector\r\n              setResolutionMode={setResolutionMode}\r\n              resolutionMode={resolutionMode}\r\n              retriggerAnalysis={retriggerAnalysis}\r\n            />\r\n          </Box>\r\n          <Divider />\r\n          <Typography\r\n            sx={{\r\n              marginLeft: 1,\r\n              marginTop: 1,\r\n              fontWeight: 'bold',\r\n            }}\r\n          >\r\n            Window Length\r\n          </Typography>\r\n          <Stack\r\n            sx={{ margin: 'auto', marginBottom: 1, marginTop: 1 }}\r\n            direction='row'\r\n          >\r\n            <Typography\r\n              sx={{\r\n                marginLeft: 1,\r\n                paddingTop: '5px',\r\n                marginRight: '5px',\r\n                fontSize: '18px',\r\n              }}\r\n              variant='h5'\r\n              gutterBottom\r\n            >{`\\u00D7 `}</Typography>\r\n            <TextField\r\n              inputProps={{ style: { textAlign: 'center' } }}\r\n              sx={{ width: '15%' }}\r\n              error={invalidWndLen}\r\n              onChange={(event) => {\r\n                setTextfieldWndLen(event.target.value);\r\n                let input = parseInt(event.target.value);\r\n                if (isNaN(input)) {\r\n                  setInvalidWndLen(true);\r\n                } else {\r\n                  setInvalidWndLen(false);\r\n                  if (coeffTracesData.length > 0) {\r\n                    if (input < 1) {\r\n                      setInvalidWndLen(true);\r\n                      setWindowLen(1);\r\n                    } else if (input > coeffTracesData[0].length) {\r\n                      setInvalidWndLen(true);\r\n                      setWindowLen(coeffTracesData[0].length);\r\n                    } else setWindowLen(input);\r\n                  } else {\r\n                    setWindowLen(input);\r\n                  }\r\n                }\r\n              }}\r\n              value={textfieldWndLen}\r\n              variant='standard'\r\n            />\r\n            <Typography\r\n              sx={{\r\n                marginLeft: 1,\r\n                paddingTop: '5px',\r\n                fontSize: '18px',\r\n              }}\r\n              variant='h5'\r\n              gutterBottom\r\n            >\r\n              {'time resolution'}\r\n            </Typography>\r\n          </Stack>\r\n          <Slider\r\n            sx={{\r\n              margin: 'auto',\r\n              width: '80%',\r\n              marginBottom: 3,\r\n              marginTop: 1,\r\n              heigth: '10%',\r\n            }}\r\n            value={windowLen}\r\n            onChange={(event, value) => {\r\n              setWindowLen(value);\r\n              setTextfieldWndLen(value);\r\n            }}\r\n            aria-label='Window Length'\r\n            defaultValue={1}\r\n            valueLabelDisplay='auto'\r\n            min={1}\r\n            max={coeffTracesData.length > 0 ? coeffTracesData[0].length : 100}\r\n            marks={\r\n              coeffTracesData.length > 0\r\n                ? [\r\n                    { value: 1, label: '1' },\r\n                    {\r\n                      value: coeffTracesData[0].length,\r\n                      label: `${coeffTracesData[0].length}`,\r\n                    },\r\n                  ]\r\n                : [\r\n                    { value: 1, label: '1' },\r\n                    { value: 100, label: '100' },\r\n                  ]\r\n            }\r\n          />\r\n          <Divider />\r\n          <Typography sx={{ marginLeft: 1, marginTop: 1, fontWeight: 'bold' }}>\r\n            Custom pitch-class vectors\r\n          </Typography>\r\n          <Box\r\n            sx={{\r\n              flexDirection: 'column',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              margin: '3% 5%',\r\n              height: '40%',\r\n              maxHeight: '350px',\r\n              justifyContent: 'flex-start',\r\n            }}\r\n            component='form'\r\n            noValidate\r\n            autoComplete='off'\r\n          >\r\n            <TextField\r\n              /* sx={{ minHeight: '5rem' }} */\r\n              fullWidth\r\n              label={'margin=\"dense\"'}\r\n              error={isInputPcvInvalid}\r\n              helperText={isInputPcvInvalid && 'Invalid input'}\r\n              id='outlined-basic'\r\n              label='e.g. {0,0,4,7,10} (2,0,0,0,1,0,0,1,0,0,1,0)'\r\n              variant='outlined'\r\n              onKeyPress={(event) => {\r\n                if (event.key === 'Enter') {\r\n                  event.preventDefault();\r\n                  handleSubmitPitchClass(pcvTextRef.current.value);\r\n                  pcvTextRef.current.value = '';\r\n                }\r\n              }}\r\n              onChange={() => {\r\n                setIsInputPcvInvalid(false);\r\n              }}\r\n              inputRef={pcvTextRef}\r\n            />\r\n            <PcvChipsBox\r\n              userPcvs={userPcvs}\r\n              setUserPcvs={setUserPcvs}\r\n              rosesMat={rosesMat}\r\n            />\r\n          </Box>\r\n          <Divider />\r\n          <Typography sx={{ marginLeft: 1, marginTop: 1, fontWeight: 'bold' }}>\r\n            Legend of coefficients\r\n          </Typography>\r\n          <Box sx={{ margin: '5px 10px' }}>\r\n            <Paper>\r\n              <Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    <circle cx='12' cy='12' r='8' fill='black' />\r\n                    <text\r\n                      fontSize='15'\r\n                      textAnchor='middle'\r\n                      x='12'\r\n                      y='17'\r\n                      fill='white'\r\n                    >\r\n                      k\r\n                    </text>\r\n                  </svg>\r\n                  Fourier coefficient number\r\n                </Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    <circle cx='12' cy='12' r='6' fill='black' />\r\n                  </svg>\r\n                  MIDI file segments\r\n                </Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    <circle cx='12' cy='12' r='5' fill='white' />\r\n                    <circle\r\n                      cx='12'\r\n                      cy='12'\r\n                      r='5'\r\n                      fill='none'\r\n                      stroke='black'\r\n                      strokeWidth='3px'\r\n                    />\r\n                  </svg>\r\n                  MIDI playback\r\n                </Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    <g transform='translate(12,12)'>\r\n                      <line\r\n                        x1='0'\r\n                        x2='0'\r\n                        y1='7'\r\n                        y2='-7'\r\n                        stroke='black'\r\n                        strokeWidth='1.5'\r\n                      ></line>\r\n                      <line\r\n                        x1='7'\r\n                        x2='-7'\r\n                        y1='0'\r\n                        y2='0'\r\n                        stroke='black'\r\n                        strokeWidth='1.5'\r\n                      ></line>\r\n                    </g>\r\n                  </svg>\r\n                  MIDI controller input\r\n                </Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    <circle\r\n                      cx='12'\r\n                      cy='12'\r\n                      r='7'\r\n                      fill='none'\r\n                      stroke='grey'\r\n                      strokeWidth='2px'\r\n                    />\r\n                  </svg>\r\n                  Prototypes\r\n                </Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    {rosesMat.length > 0 ? (\r\n                      <polyline\r\n                        transform={`translate(${12},${12})`}\r\n                        fill='none'\r\n                        stroke='black'\r\n                        strokeWidth='1px'\r\n                        points={rosesMat[3][0].points}\r\n                      />\r\n                    ) : null}\r\n                  </svg>\r\n                  Custom pitch-class vectors\r\n                </Stack>\r\n              </Stack>\r\n            </Paper>\r\n          </Box>\r\n          <SaveDialog\r\n            traces={windowedCoeffTraces}\r\n            userPcvs={userPcvs}\r\n            wavescapesData={wavescapesData}\r\n          />\r\n        </Drawer>\r\n        <Main open={open}>\r\n          <Switch>\r\n            <Route\r\n              exact\r\n              path='/'\r\n              render={() => (\r\n                <Home\r\n                  setOpen={setOpen}\r\n                  setInAnalysisPage={setInAnalysisPage}\r\n                ></Home>\r\n              )}\r\n            ></Route>\r\n            <Route\r\n              exact\r\n              path='/theory'\r\n              render={() => (\r\n                <Theory\r\n                  setOpen={setOpen}\r\n                  setInAnalysisPage={setInAnalysisPage}\r\n                ></Theory>\r\n              )}\r\n            ></Route>\r\n            <Route\r\n              exact\r\n              path='/analysis'\r\n              render={() => (\r\n                <Analysis\r\n                  fileName={fileName}\r\n                  setInAnalysisPage={setInAnalysisPage}\r\n                  open={open}\r\n                  setOpen={setOpen}\r\n                  wavescapesData={wavescapesData}\r\n                  fullTraces={coeffTracesData}\r\n                  coeffTracesData={windowedCoeffTraces}\r\n                  currentSubdiv={\r\n                    windowedCoeffTraces.length > 0 &&\r\n                    Math.floor(windowLen / 2) + currentSubdiv >=\r\n                      windowedCoeffTraces[0].length\r\n                      ? windowedCoeffTraces[0].length - 1\r\n                      : Math.floor(windowLen / 2) + currentSubdiv\r\n                  }\r\n                  currentWavescapeSubdiv={Math.floor(\r\n                    (currentSubdiv * circleResolution) / wavescapeResolution\r\n                  )}\r\n                  userPcvs={userPcvs}\r\n                />\r\n              )}\r\n            ></Route>\r\n          </Switch>\r\n        </Main>\r\n      </Box>\r\n    </HashRouter>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","export default function parse(input) {\r\n  let pcvs = [];\r\n  //Vectorial notation, distribution -> real numbers\r\n  const openVect = '(';\r\n  const closeVect = ')';\r\n  //Set notation, integers\r\n  const openSet = '{';\r\n  const closeSet = '}';\r\n  //Number divider\r\n  const divider = ',';\r\n\r\n  let isGroup = false;\r\n  let isSet = false;\r\n\r\n  for (let i = 0; i < input.length; i++) {\r\n    if (input[i] === openSet || input[i] === openVect) {\r\n      isGroup = true;\r\n      if (input[i] === openSet) isSet = true;\r\n    }\r\n\r\n    if (isGroup) {\r\n      let stringGroup = [];\r\n      //Slice the current group\r\n      for (\r\n        let j = i + 1;\r\n        input[j] !== closeSet && input[j] !== closeVect;\r\n        j++\r\n      ) {\r\n        //Check if there is an invalid char in the group\r\n        if (\r\n          input[j] !== ',' &&\r\n          input[j] !== '.' &&\r\n          input[j] !== ' ' &&\r\n          isNaN(parseFloat(input[j]))\r\n        )\r\n          throw new Error('Found NaN');\r\n        if (input[j] !== ' ') stringGroup.push(input[j]);\r\n      }\r\n\r\n      stringGroup = stringGroup.join('');\r\n\r\n      //Check if the empty string\r\n      if (stringGroup === '') throw new Error('Empty input');\r\n\r\n      let numeralInput = [];\r\n      let count = 0;\r\n      for (let j = 0; j < stringGroup.length; j++) {\r\n        if (stringGroup[j] === divider) {\r\n          let num = stringGroup.slice(j - count, j);\r\n          //if num.length === 0 => two consecutive comas, invalid input\r\n          if (num.length === 0) throw new Error('Two consecutive comas');\r\n\r\n          numeralInput.push(+num);\r\n          count = -1;\r\n        }\r\n        count++;\r\n      }\r\n      //Last element not cover by the for cycle\r\n      let lastNum = stringGroup.slice(\r\n        stringGroup.length - count,\r\n        stringGroup.length\r\n      );\r\n      //Check if there is a last number\r\n      if (lastNum.length === 0) {\r\n        throw new Error('Missing last number');\r\n      }\r\n      numeralInput.push(+lastNum);\r\n\r\n      if (isSet) {\r\n        let bin = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n        for (let i = 0; i < numeralInput.length; i++) {\r\n          //Set notation: check if num is valid range [0,11]\r\n          if (numeralInput[i] < 0 || numeralInput[i] >= 12) {\r\n            throw new Error('Set notation: out of range');\r\n          }\r\n\r\n          bin[numeralInput[i]] += 1;\r\n        }\r\n        pcvs.push(bin);\r\n      } else {\r\n        //If is in vectorial form, check if there are 12 elements\r\n        if (numeralInput.length !== 12) {\r\n          throw new Error('Vectorial notation: missing elements');\r\n        }\r\n        pcvs.push(numeralInput);\r\n      }\r\n\r\n      isGroup = false;\r\n      isSet = false;\r\n      i += count;\r\n    }\r\n  }\r\n\r\n  if (pcvs.length === 0) throw new Error('Invalid input');\r\n\r\n  return pcvs;\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\n\r\nconst customTheme = createTheme({\r\n  palette: {\r\n    primary: {\r\n      main: '#323232',\r\n    },\r\n    secondary: {\r\n      main: '#fefefe',\r\n    },\r\n    background: {\r\n      default: '#e0e0e0',\r\n    },\r\n  },\r\n});\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <ThemeProvider theme={customTheme}>\r\n      <App />\r\n    </ThemeProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}